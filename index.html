<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
<title>7/D Sohbet + Oyunlar + Premium</title>

<style>
* {
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  box-sizing: border-box;
  overscroll-behavior: none;
}

html, body {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  touch-action: none;
}

body {
  margin: 0;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: #0a0c12;
  color: #e4e6f0;
  overflow: hidden;
  position: fixed;
  width: 100%;
  height: 100%;
}

/* Animated gradient background */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: linear-gradient(45deg, #1a2f4f, #0a0f1f, #2f1f4f, #1a0f2f, #0f2a3a);
  background-size: 500% 500%;
  animation: gradientBG 20s ease infinite;
  z-index: -2;
}

@keyframes gradientBG {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at 70% 60%, rgba(47, 31, 79, 0.6) 0%, transparent 70%),
              radial-gradient(circle at 30% 40%, rgba(26, 47, 79, 0.4) 0%, transparent 60%);
  z-index: -1;
  animation: pulseBG 8s ease-in-out infinite;
}

@keyframes pulseBG {
  0%, 100% { opacity: 0.4; }
  50% { opacity: 0.7; }
}

/* Login ekranı */
#login {
  position: fixed;
  inset: 0;
  background: rgba(10, 12, 18, 0.98);
  backdrop-filter: blur(20px);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 16px;
  z-index: 10;
  animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.95); }
  to { opacity: 1; transform: scale(1); }
}

#login input {
  height: 52px;
  width: 85%;
  max-width: 300px;
  border-radius: 16px;
  border: 2px solid #2a3a4a;
  background: #1a1f2a;
  padding: 0 20px;
  font-size: 16px;
  color: #fff;
  transition: all 0.3s ease;
  -webkit-user-select: text;
  user-select: text;
}

#login input:focus {
  outline: none;
  border-color: #4a9eff;
  box-shadow: 0 0 0 4px rgba(74, 158, 255, 0.2);
  transform: scale(1.02);
}

#login input[type="file"] {
  padding: 12px;
  background: #1a1f2a;
  color: #e4e6f0;
  border: 2px dashed #3a4a5a;
  height: auto;
}

#login button {
  height: 52px;
  width: 85%;
  max-width: 300px;
  border-radius: 16px;
  border: none;
  background: linear-gradient(135deg, #2a6eff, #4a9eff);
  color: white;
  font-weight: 700;
  font-size: 17px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 8px 24px rgba(42, 110, 255, 0.3);
}

#login button:hover {
  transform: translateY(-3px) scale(1.02);
  box-shadow: 0 12px 32px rgba(42, 110, 255, 0.4);
}

#login button:active {
  transform: translateY(-1px) scale(0.98);
}

#login-error {
  color: #ff5a5a;
  font-size: 14px;
  min-height: 20px;
  max-width: 300px;
  text-align: center;
  font-weight: 500;
}

/* Profil fotoğrafı preview */
#pfp-preview {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  background: #1a1f2a;
  margin-bottom: 8px;
  object-fit: cover;
  border: 4px solid #2a6eff;
  display: none;
  box-shadow: 0 12px 30px rgba(42, 110, 255, 0.4);
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

/* Menü butonu */
#menu-btn {
  position: fixed;
  left: 16px;
  top: 16px;
  width: 48px;
  height: 48px;
  background: rgba(26, 31, 42, 0.9);
  border: 2px solid #2a3a4a;
  border-radius: 14px;
  color: #e4e6f0;
  font-size: 24px;
  cursor: pointer;
  z-index: 100;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
}

#menu-btn:hover {
  background: #2a3a4a;
  border-color: #4a9eff;
  color: #fff;
  transform: scale(1.1) rotate(90deg);
}

/* Sidebar (Menü) */
#sidebar {
  position: fixed;
  left: -100%;
  top: 0;
  bottom: 0;
  width: 85%;
  max-width: 320px;
  background: rgba(15, 18, 25, 0.98);
  border-right: 2px solid #1e2a3a;
  padding: 80px 20px 20px;
  z-index: 99;
  transition: left 0.4s cubic-bezier(0.2, 0.9, 0.3, 1);
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  box-shadow: 8px 0 40px rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(20px);
}

#sidebar.open {
  left: 0;
}

#sidebar-header {
  padding: 0 8px 20px;
  border-bottom: 2px solid #1e2a3a;
  margin-bottom: 24px;
}

#sidebar-header h3 {
  margin: 0;
  color: #aab6c8;
  font-size: 14px;
  font-weight: 600;
  letter-spacing: 1px;
  text-transform: uppercase;
}

.sidebar-btn {
  width: 100%;
  margin: 6px 0;
  padding: 16px 20px;
  background: transparent;
  border: none;
  border-radius: 14px;
  color: #b4c0d0;
  cursor: pointer;
  font-size: 16px;
  font-weight: 600;
  transition: all 0.3s ease;
  text-align: left;
  display: flex;
  align-items: center;
  gap: 14px;
}

.sidebar-btn:hover {
  background: rgba(42, 110, 255, 0.15);
  color: #fff;
  transform: translateX(8px);
}

.sidebar-btn.active {
  background: linear-gradient(135deg, rgba(42, 110, 255, 0.3), rgba(74, 158, 255, 0.2));
  color: #fff;
  font-weight: 700;
  border: 1px solid rgba(74, 158, 255, 0.5);
  box-shadow: 0 4px 16px rgba(42, 110, 255, 0.2);
}

.sidebar-btn i {
  font-size: 22px;
  width: 32px;
  opacity: 0.9;
}

/* Sidebar overlay */
#sidebar-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(8px);
  z-index: 98;
  display: none;
  opacity: 0;
  transition: opacity 0.3s ease;
}

#sidebar-overlay.show {
  display: block;
  opacity: 1;
}

/* Ana içerik */
#main-content {
  position: absolute;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
  background: transparent;
  overflow: hidden;
}

/* Sohbet ekranı */
#chat-screen {
  height: 100%;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

#topbar {
  height: 70px;
  background: rgba(15, 18, 25, 0.95);
  border-bottom: 2px solid #1e2a3a;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  flex-shrink: 0;
  padding: 0 16px;
  backdrop-filter: blur(10px);
}

#admin-badge {
  position: absolute;
  left: 70px;
  background: linear-gradient(135deg, #ffaa2a, #ffcc4a);
  color: #0a0c12;
  padding: 6px 14px;
  border-radius: 30px;
  font-size: 11px;
  font-weight: 700;
  display: none;
  letter-spacing: 0.5px;
  box-shadow: 0 4px 12px rgba(255, 170, 42, 0.4);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { box-shadow: 0 4px 12px rgba(255, 170, 42, 0.4); }
  50% { box-shadow: 0 4px 20px rgba(255, 170, 42, 0.7); }
}

#points-display {
  position: absolute;
  left: 70px;
  background: linear-gradient(135deg, #1e2a3a, #2a3a4a);
  color: #ffaa2a;
  padding: 8px 18px;
  border-radius: 30px;
  font-size: 14px;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 6px;
  border: 2px solid #3a4a5a;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

#onlineBtn {
  position: absolute;
  right: 16px;
  background: rgba(26, 33, 46, 0.8);
  border: 2px solid #2a3a4a;
  border-radius: 30px;
  padding: 10px 20px;
  color: #b4c0d0;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 8px;
}

#onlineBtn:hover {
  background: #1e2a3a;
  border-color: #4a9eff;
  color: #fff;
  transform: scale(1.05);
}

#shop-btn {
  position: absolute;
  right: 130px;
  background: linear-gradient(135deg, #1a2a3a, #2a3a4a);
  border: 2px solid #2a6eff;
  border-radius: 30px;
  padding: 10px 20px;
  color: #fff;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 8px;
  box-shadow: 0 4px 16px rgba(42, 110, 255, 0.3);
}

#shop-btn:hover {
  background: #2a6eff;
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 8px 24px rgba(42, 110, 255, 0.4);
}

#inventory-btn {
  position: absolute;
  right: 240px;
  background: linear-gradient(135deg, #2a2a1a, #3a3a2a);
  border: 2px solid #ffaa2a;
  border-radius: 30px;
  padding: 10px 20px;
  color: #fff;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 8px;
  box-shadow: 0 4px 16px rgba(255, 170, 42, 0.3);
}

#inventory-btn:hover {
  background: #ffaa2a;
  color: #0a0c12;
  transform: translateY(-2px) scale(1.05);
}

/* Yazıyor göstergesi */
#typing-indicator {
  position: absolute;
  bottom: 90px;
  left: 20px;
  background: rgba(26, 33, 46, 0.95);
  padding: 10px 20px;
  border-radius: 30px;
  font-size: 14px;
  color: #aab6c8;
  display: none;
  align-items: center;
  gap: 10px;
  z-index: 10;
  border: 2px solid #2a3a4a;
  backdrop-filter: blur(10px);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
  animation: slideUp 0.3s ease;
}

@keyframes slideUp {
  from { transform: translateY(20px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.typing-dots {
  display: inline-flex;
  gap: 4px;
}

.typing-dots span {
  width: 8px;
  height: 8px;
  background: #4a9eff;
  border-radius: 50%;
  display: inline-block;
  animation: typingBounce 1.4s infinite ease-in-out;
}

.typing-dots span:nth-child(2) { animation-delay: 0.2s; }
.typing-dots span:nth-child(3) { animation-delay: 0.4s; }

@keyframes typingBounce {
  0%, 60%, 100% { transform: translateY(0); }
  30% { transform: translateY(-8px); }
}

#onlinePanel {
  position: fixed;
  top: 80px;
  right: 16px;
  background: rgba(15, 18, 25, 0.98);
  border: 2px solid #1e2a3a;
  border-radius: 20px;
  padding: 16px;
  display: none;
  min-width: 280px;
  max-height: 400px;
  overflow-y: auto;
  z-index: 50;
  box-shadow: 0 16px 40px rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(20px);
  animation: slideDown 0.3s ease;
}

@keyframes slideDown {
  from { transform: translateY(-20px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.userItem {
  padding: 12px 16px;
  border-radius: 12px;
  font-size: 15px;
  display: flex;
  align-items: center;
  gap: 12px;
  transition: all 0.3s ease;
  margin-bottom: 8px;
}

.userItem:hover {
  background: rgba(42, 110, 255, 0.1);
  transform: translateX(4px);
}

.userItem .user-pfp {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  object-fit: cover;
  border: 3px solid #2a3a4a;
  transition: all 0.3s ease;
}

.userItem:hover .user-pfp {
  border-color: #4a9eff;
  transform: scale(1.1);
}

.userItem .user-info {
  flex: 1;
  color: #e4e6f0;
  font-weight: 600;
}

.userItem .admin-actions {
  display: flex;
  gap: 8px;
  margin-left: auto;
}

.userItem .admin-actions button {
  padding: 8px 12px;
  font-size: 12px;
  background: rgba(30, 42, 58, 0.8);
  color: #b4c0d0;
  border: 1px solid #2a3a4a;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 600;
}

.userItem .admin-actions button:hover {
  transform: scale(1.1);
}

.userItem .admin-actions button:nth-child(1):hover {
  background: #ff5a5a;
  border-color: #ff5a5a;
  color: white;
}

.userItem .admin-actions button:nth-child(2):hover {
  background: #ffaa2a;
  border-color: #ffaa2a;
  color: #0a0c12;
}

.userItem .admin-actions button:nth-child(3):hover {
  background: #4a9eff;
  border-color: #4a9eff;
  color: white;
}

.userItem.banned {
  opacity: 0.5;
  text-decoration: line-through;
}

.userItem.muted {
  color: #ffaa2a;
}

#chat {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 14px;
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
}

.msg {
  max-width: 80%;
  padding: 14px 18px;
  border-radius: 24px;
  font-size: 15px;
  line-height: 1.6;
  word-wrap: break-word;
  animation: messagePop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  position: relative;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
  transition: all 0.3s ease;
}

.msg:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
}

@keyframes messagePop {
  0% { opacity: 0; transform: scale(0.8) translateY(20px); }
  70% { transform: scale(1.05); }
  100% { opacity: 1; transform: scale(1) translateY(0); }
}

.user { 
  background: linear-gradient(135deg, #1a212e, #252b3a);
  align-self: flex-start; 
  border-bottom-left-radius: 8px;
  border: 2px solid #2a3a4a;
}

.me { 
  background: linear-gradient(135deg, #1a3a6a, #2a4a8a);
  align-self: flex-end; 
  border-bottom-right-radius: 8px;
  border: 2px solid #4a9eff;
}

.admin { 
  background: linear-gradient(135deg, #4a2a2a, #5a3a3a);
  align-self: flex-start; 
  border-bottom-left-radius: 8px;
  border: 2px solid #ff5a5a;
}

/* Mesaj balonu stilleri - Geçişli ve Animasyonlu */
.msg.style-green {
  background: linear-gradient(135deg, #1a4a2a, #0a3a1a, #2a6a4a, #1a5a3a);
  background-size: 300% 300%;
  animation: gradientShift 4s ease infinite, glowGreen 2s ease-in-out infinite alternate;
  border-color: #4aff4a;
}

@keyframes glowGreen {
  from { box-shadow: 0 4px 16px rgba(74, 255, 74, 0.3); }
  to { box-shadow: 0 8px 32px rgba(74, 255, 74, 0.6); }
}

.msg.style-rgb {
  background: linear-gradient(135deg, #ff0066, #6600ff, #0066ff, #00ff66, #ff6600);
  background-size: 400% 400%;
  animation: gradientShift 3s ease infinite, glowRGB 2s ease-in-out infinite alternate;
  border: 3px solid transparent;
  background-clip: padding-box;
}

@keyframes glowRGB {
  from { box-shadow: 0 4px 20px rgba(255, 0, 102, 0.4); }
  to { box-shadow: 0 12px 40px rgba(102, 0, 255, 0.6); }
}

.msg.style-gold {
  background: linear-gradient(135deg, #4a3a1a, #8a6a2a, #c4a442, #ffd700, #8a6a2a);
  background-size: 300% 300%;
  animation: gradientShift 5s ease infinite, glowGold 2s ease-in-out infinite alternate;
  border-color: #ffd700;
}

@keyframes glowGold {
  from { box-shadow: 0 4px 16px rgba(255, 215, 0, 0.4); }
  to { box-shadow: 0 12px 40px rgba(255, 215, 0, 0.7); }
}

.msg.style-ocean {
  background: linear-gradient(135deg, #0a2a4a, #1a4a6a, #2a6a8a, #4a9aaa, #1a6a9a);
  background-size: 300% 300%;
  animation: gradientShift 6s ease infinite, wave 3s ease-in-out infinite;
  border-color: #4a9eff;
}

@keyframes wave {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-3px); }
}

.msg.style-fire {
  background: linear-gradient(135deg, #4a1a0a, #8a2a1a, #ff4a1a, #ff8a2a, #ffaa4a);
  background-size: 300% 300%;
  animation: gradientShift 2s ease infinite, flicker 0.5s ease-in-out infinite alternate;
  border-color: #ff6a2a;
}

@keyframes flicker {
  0% { opacity: 1; }
  50% { opacity: 0.95; }
  100% { opacity: 1; }
}

.msg.style-ice {
  background: linear-gradient(135deg, #0a1a2a, #1a3a4a, #2a5a6a, #4a8a9a, #8accdd);
  background-size: 300% 300%;
  animation: gradientShift 8s ease infinite, freeze 4s ease-in-out infinite;
  border-color: #8accdd;
}

@keyframes freeze {
  0%, 100% { filter: brightness(1); }
  50% { filter: brightness(1.2); }
}

.msg.style-purple {
  background: linear-gradient(135deg, #1a0a2a, #3a1a5a, #6a2a8a, #aa4aff, #8a2aaa);
  background-size: 300% 300%;
  animation: gradientShift 5s ease infinite, pulsePurple 3s ease-in-out infinite;
  border-color: #aa4aff;
}

@keyframes pulsePurple {
  0%, 100% { box-shadow: 0 4px 16px rgba(170, 74, 255, 0.4); }
  50% { box-shadow: 0 12px 40px rgba(170, 74, 255, 0.7); }
}

.msg.style-neon {
  background: #0a0a0a;
  border: 3px solid #00ff00;
  animation: neonPulse 1s ease-in-out infinite alternate, neonFlicker 0.1s infinite;
  box-shadow: 0 0 20px #00ff00, 0 0 40px #00ff00, inset 0 0 20px rgba(0, 255, 0, 0.1);
  color: #00ff00;
  font-family: 'Courier New', monospace;
  text-shadow: 0 0 10px #00ff00;
}

@keyframes neonPulse {
  from { box-shadow: 0 0 20px #00ff00, 0 0 40px #00ff00; }
  to { box-shadow: 0 0 30px #00ff00, 0 0 60px #00ff00, 0 0 80px #00ff00; }
}

@keyframes neonFlicker {
  0%, 100% { opacity: 1; }
  95% { opacity: 1; }
  96% { opacity: 0.8; }
  97% { opacity: 1; }
}

.msg.style-sunset {
  background: linear-gradient(135deg, #ff2a4a, #ff5a4a, #ff8a4a, #ffaa4a, #ffca4a, #ff8a6a);
  background-size: 400% 400%;
  animation: gradientShift 7s ease infinite, sunsetGlow 4s ease-in-out infinite;
  border-color: #ff8a4a;
}

@keyframes sunsetGlow {
  0%, 100% { filter: hue-rotate(0deg); }
  50% { filter: hue-rotate(30deg); }
}

.msg.style-matrix {
  background: #000;
  border: 2px solid #00ff00;
  color: #00ff00;
  font-family: 'Courier New', monospace;
  text-shadow: 0 0 10px #00ff00;
  box-shadow: 0 0 20px rgba(0, 255, 0, 0.3), inset 0 0 30px rgba(0, 255, 0, 0.05);
  animation: matrixRain 0.5s linear infinite;
}

@keyframes matrixRain {
  0% { background-position: 0 0; }
  100% { background-position: 0 20px; }
}

.msg.style-blackwhite {
  background: linear-gradient(135deg, #0a0a0a, #2a2a2a, #ffffff, #e0e0e0, #0a0a0a, #ffffff);
  background-size: 600% 600%;
  animation: gradientShift 4s ease infinite, bwPulse 2s ease-in-out infinite;
  border: 3px solid #fff;
  color: #000;
  font-weight: bold;
  box-shadow: 0 4px 24px rgba(255, 255, 255, 0.4), 0 0 40px rgba(0, 0, 0, 0.5);
}

@keyframes bwPulse {
  0%, 100% { filter: contrast(1); }
  50% { filter: contrast(1.3); }
}

@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.msg-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 8px;
  font-size: 13px;
}

.msg-pfp {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  object-fit: cover;
  border: 3px solid rgba(255, 255, 255, 0.3);
  transition: all 0.3s ease;
}

.msg:hover .msg-pfp {
  transform: scale(1.2) rotate(10deg);
  border-color: #4a9eff;
}

.msg-username {
  font-weight: 700;
  color: #b4d0ff;
  display: flex;
  align-items: center;
  gap: 6px;
}

.admin-crown {
  color: #ffaa2a;
  font-size: 14px;
  animation: crownShine 2s infinite;
}

@keyframes crownShine {
  0%, 100% { filter: brightness(1); }
  50% { filter: brightness(1.5); }
}

.msg-time {
  color: #8892a6;
  font-size: 12px;
  margin-left: auto;
}

.msg .delete-btn {
  position: absolute;
  top: -10px;
  right: -10px;
  background: linear-gradient(135deg, #ff5a5a, #ff3a3a);
  color: white;
  border: none;
  border-radius: 50%;
  width: 28px;
  height: 28px;
  font-size: 14px;
  cursor: pointer;
  display: none;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 12px rgba(255, 90, 90, 0.5);
  transition: all 0.3s ease;
  z-index: 10;
}

.msg:hover .delete-btn {
  display: flex;
  animation: popIn 0.3s ease;
}

.msg .delete-btn:hover {
  transform: scale(1.2) rotate(90deg);
  background: #ff1a1a;
}

.msg .video-container {
  margin-top: 10px;
  border-radius: 16px;
  overflow: hidden;
  max-width: 100%;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
}

.msg video {
  max-width: 100%;
  max-height: 300px;
  border-radius: 16px;
}

.msg img {
  max-width: 240px;
  border-radius: 16px;
  margin-top: 10px;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
  transition: all 0.3s ease;
}

.msg img:hover {
  transform: scale(1.05);
}

#inputBar {
  height: 80px;
  background: rgba(15, 18, 25, 0.98);
  border-top: 2px solid #1e2a3a;
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 16px;
  flex-shrink: 0;
  backdrop-filter: blur(10px);
}

#text {
  flex: 1;
  height: 52px;
  border: 2px solid #2a3a4a;
  border-radius: 26px;
  background: #1a212e;
  padding: 0 22px;
  font-size: 16px;
  color: #fff;
  transition: all 0.3s ease;
  -webkit-user-select: text;
  user-select: text;
}

#text:focus {
  outline: none;
  border-color: #4a9eff;
  box-shadow: 0 0 0 4px rgba(74, 158, 255, 0.2);
}

#text:disabled {
  opacity: 0.5;
  background: #0a121a;
}

#imgInput, #videoInput {
  display: none;
}

.media-btn {
  width: 52px;
  height: 52px;
  background: linear-gradient(135deg, #1a212e, #252b3a);
  border: 2px solid #2a3a4a;
  border-radius: 26px;
  color: #b4c0d0;
  font-size: 22px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  flex-shrink: 0;
}

.media-btn:hover {
  background: #2a3a4a;
  color: #fff;
  border-color: #4a9eff;
  transform: scale(1.1) rotate(10deg);
}

.send-btn {
  padding: 0 28px;
  height: 52px;
  background: linear-gradient(135deg, #2a6eff, #4a9eff);
  border: none;
  border-radius: 26px;
  color: white;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  flex-shrink: 0;
  box-shadow: 0 4px 16px rgba(42, 110, 255, 0.3);
}

.send-btn:hover {
  background: linear-gradient(135deg, #1a5eef, #3a8eff);
  transform: scale(1.05);
  box-shadow: 0 8px 24px rgba(42, 110, 255, 0.4);
}

.send-btn:active {
  transform: scale(0.98);
}

/* Altun.ai ekranı */
#altun-screen {
  height: 100%;
  display: flex;
  flex-direction: column;
  background: #0a0c12;
  overflow: hidden;
}

#altun-header {
  padding: 20px;
  background: rgba(15, 18, 25, 0.98);
  border-bottom: 2px solid #1e2a3a;
  color: #e4e6f0;
  font-weight: 700;
  text-align: center;
  font-size: 20px;
  flex-shrink: 0;
  letter-spacing: 0.5px;
  backdrop-filter: blur(10px);
}

#altun-messages {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
}

.altun-message {
  margin: 14px 0;
  padding: 16px 22px;
  border-radius: 24px;
  max-width: 85%;
  animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  line-height: 1.6;
  font-size: 15px;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
}

.altun-user {
  background: linear-gradient(135deg, #1a3a6a, #2a4a8a);
  margin-left: auto;
  border-bottom-right-radius: 8px;
  border: 2px solid #4a9eff;
}

.altun-bot {
  background: linear-gradient(135deg, #1a2a3a, #2a3a4a);
  color: #e4e6f0;
  border-bottom-left-radius: 8px;
  border: 2px solid #2a3a4a;
}

.typing {
  display: inline-block;
  margin-left: 6px;
}

.dot {
  animation: blink 1.4s infinite both;
  font-size: 20px;
  line-height: 1;
}

.dot:nth-child(2) { animation-delay: 0.2s; }
.dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes blink {
  0% { opacity: 0.2; }
  20% { opacity: 1; }
  100% { opacity: 0.2; }
}

#altun-input-area {
  display: flex;
  padding: 20px;
  background: rgba(15, 18, 25, 0.98);
  border-top: 2px solid #1e2a3a;
  flex-shrink: 0;
  gap: 12px;
  backdrop-filter: blur(10px);
}

#altun-input {
  flex: 1;
  padding: 16px 24px;
  border-radius: 30px;
  border: 2px solid #2a3a4a;
  background: #1a212e;
  outline: none;
  font-size: 16px;
  color: #fff;
  transition: all 0.3s ease;
  -webkit-user-select: text;
  user-select: text;
}

#altun-input:focus {
  border-color: #4a9eff;
  box-shadow: 0 0 0 4px rgba(74, 158, 255, 0.2);
}

.altun-btn {
  padding: 0 28px;
  border: none;
  border-radius: 30px;
  background: linear-gradient(135deg, #2a6eff, #4a9eff);
  color: white;
  font-weight: 700;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 16px rgba(42, 110, 255, 0.3);
}

.altun-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 8px 24px rgba(42, 110, 255, 0.4);
}

/* Oyun Ekranları - Mobil Optimizasyonlu */
.game-screen {
  width: 100%;
  height: 100%;
  background: #0a0c12;
  display: flex;
  flex-direction: column;
  padding: 12px;
  overflow: hidden;
  position: relative;
}

.game-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
  padding: 14px 18px;
  background: rgba(15, 18, 25, 0.98);
  border-radius: 20px;
  border: 2px solid #1e2a3a;
  backdrop-filter: blur(10px);
  flex-shrink: 0;
}

.game-header h2 {
  color: #e4e6f0;
  margin: 0;
  font-size: 18px;
  font-weight: 700;
}

.server-selector {
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
  flex-shrink: 0;
}

.server-btn {
  flex: 1;
  padding: 12px;
  background: rgba(26, 33, 46, 0.8);
  border: 2px solid #2a3a4a;
  border-radius: 14px;
  color: #b4c0d0;
  font-size: 13px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
}

.server-btn.active {
  background: linear-gradient(135deg, #2a6eff, #4a9eff);
  border-color: #4a9eff;
  color: white;
  box-shadow: 0 4px 16px rgba(42, 110, 255, 0.3);
}

.game-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 12px;
  min-height: 0;
  overflow: hidden;
}

.game-sidebar {
  background: rgba(15, 18, 25, 0.98);
  border: 2px solid #1e2a3a;
  border-radius: 20px;
  padding: 16px;
  overflow-y: auto;
  flex-shrink: 0;
  max-height: 30%;
  backdrop-filter: blur(10px);
}

.game-sidebar h3 {
  color: #aab6c8;
  margin: 0 0 14px 0;
  font-size: 15px;
  font-weight: 700;
  letter-spacing: 0.5px;
}

.rooms-list {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.room-item {
  padding: 14px;
  background: rgba(26, 33, 46, 0.8);
  border: 2px solid #2a3a4a;
  border-radius: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.room-item:hover, .room-item:active {
  background: rgba(42, 110, 255, 0.15);
  border-color: #4a9eff;
  transform: translateX(6px);
}

.room-item .room-name {
  color: #e4e6f0;
  font-weight: 700;
  margin-bottom: 6px;
  font-size: 15px;
}

.room-item .room-players {
  font-size: 13px;
  color: #8892a6;
  font-weight: 500;
}

.game-area {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  background: rgba(15, 18, 25, 0.98);
  border: 2px solid #1e2a3a;
  border-radius: 20px;
  padding: 16px;
  position: relative;
  overflow: hidden;
}

/* Yılan Oyunu */
#snake-screen canvas {
  width: 100%;
  height: 100%;
  max-width: 600px;
  max-height: 600px;
  border-radius: 16px;
  background: #0a0a0a;
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
}

.joystick-area {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 150px;
  height: 150px;
  background: rgba(26, 33, 46, 0.6);
  border: 3px solid #2a3a4a;
  border-radius: 50%;
  touch-action: none;
}

.joystick-knob {
  position: absolute;
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg, #2a6eff, #4a9eff);
  border-radius: 50%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  box-shadow: 0 4px 16px rgba(42, 110, 255, 0.4);
  transition: transform 0.1s ease;
}

/* Araba Oyunu */
#car-screen canvas {
  width: 100%;
  height: 100%;
  border-radius: 16px;
  background: linear-gradient(180deg, #1a1a2a 0%, #0a0a1a 100%);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
}

/* XOX Oyunu */
#tictactoe-board {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  width: 100%;
  max-width: 350px;
  aspect-ratio: 1;
}

.tictactoe-cell {
  background: rgba(26, 33, 46, 0.8);
  border: 3px solid #2a3a4a;
  border-radius: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 48px;
  cursor: pointer;
  transition: all 0.3s ease;
  aspect-ratio: 1;
}

.tictactoe-cell:hover:not(.taken) {
  background: rgba(42, 110, 255, 0.15);
  border-color: #4a9eff;
  transform: scale(1.05);
}

.tictactoe-cell.taken {
  cursor: not-allowed;
}

.tictactoe-cell.x {
  color: #ff5a5a;
  text-shadow: 0 0 20px rgba(255, 90, 90, 0.6);
  animation: placeMark 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.tictactoe-cell.o {
  color: #4a9eff;
  text-shadow: 0 0 20px rgba(74, 158, 255, 0.6);
  animation: placeMark 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes placeMark {
  0% { transform: scale(0) rotate(-180deg); opacity: 0; }
  100% { transform: scale(1) rotate(0); opacity: 1; }
}

/* Sayı Tahmin Oyunu */
#guess-screen {
  width: 100%;
  height: 100%;
  background: #0a0c12;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 16px;
  overflow: hidden;
}

#guess-container {
  width: 100%;
  max-width: 500px;
  height: 95%;
  display: flex;
  flex-direction: column;
  gap: 16px;
  overflow-y: auto;
}

#guess-scoreboard {
  background: rgba(15, 18, 25, 0.98);
  border: 2px solid #1e2a3a;
  border-radius: 24px;
  padding: 20px;
  flex-shrink: 0;
  backdrop-filter: blur(10px);
}

#guess-scoreboard h2 {
  color: #aab6c8;
  margin: 0 0 14px 0;
  font-size: 16px;
  font-weight: 700;
  letter-spacing: 0.5px;
  display: flex;
  align-items: center;
  gap: 10px;
}

#score-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
  max-height: 160px;
  overflow-y: auto;
}

.score-item {
  background: rgba(26, 33, 46, 0.8);
  padding: 10px 16px;
  border-radius: 30px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 14px;
  border: 2px solid #2a3a4a;
  transition: all 0.3s ease;
}

.score-item.me {
  background: linear-gradient(135deg, rgba(42, 110, 255, 0.2), rgba(74, 158, 255, 0.1));
  border-color: #4a9eff;
  transform: scale(1.02);
}

.score-item .rank {
  font-weight: 700;
  color: #4a9eff;
  width: 36px;
  font-size: 16px;
}

.score-item .name {
  flex: 1;
  margin-left: 10px;
  color: #e4e6f0;
  font-weight: 600;
}

.score-item .score {
  background: rgba(15, 26, 42, 0.8);
  padding: 6px 14px;
  border-radius: 30px;
  color: #ffaa2a;
  font-weight: 700;
  font-size: 14px;
}

#guess-game-panel {
  background: rgba(15, 18, 25, 0.98);
  border: 2px solid #1e2a3a;
  border-radius: 32px;
  padding: 24px;
  display: flex;
  flex-direction: column;
  gap: 20px;
  flex: 1;
  min-height: 0;
  backdrop-filter: blur(10px);
}

#guess-header {
  text-align: center;
  padding: 24px;
  background: rgba(26, 33, 46, 0.8);
  border-radius: 24px;
  border: 2px solid #2a3a4a;
}

#guess-header h1 {
  font-size: 28px;
  margin: 0 0 14px 0;
  font-weight: 700;
  background: linear-gradient(135deg, #aab6c8, #e4e6f0);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

#target-number {
  font-size: 80px;
  font-weight: 800;
  color: #4a9eff;
  text-shadow: 0 4px 24px rgba(74, 158, 255, 0.4);
  line-height: 1;
  margin: 10px 0;
  animation: numberPulse 2s ease-in-out infinite;
}

@keyframes numberPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

#range-info {
  font-size: 18px;
  color: #aab6c8;
  background: rgba(15, 26, 42, 0.8);
  padding: 12px 28px;
  border-radius: 40px;
  display: inline-block;
  font-weight: 600;
}

#range-info span {
  color: #ffaa2a;
  font-weight: 700;
  font-size: 22px;
}

#guess-history {
  background: rgba(26, 33, 46, 0.8);
  border-radius: 24px;
  padding: 18px;
  border: 2px solid #2a3a4a;
}

#guess-history h3 {
  font-size: 15px;
  color: #aab6c8;
  margin: 0 0 14px 0;
  font-weight: 700;
}

.history-list {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  min-height: 60px;
  max-height: 100px;
  overflow-y: auto;
  padding: 6px;
}

.history-item {
  padding: 8px 18px;
  border-radius: 30px;
  font-weight: 600;
  font-size: 15px;
  animation: historyPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  border: 2px solid transparent;
}

@keyframes historyPop {
  0% { transform: scale(0) rotate(-20deg); opacity: 0; }
  100% { transform: scale(1) rotate(0); opacity: 1; }
}

.history-item.high { 
  background: linear-gradient(135deg, #4a2a2a, #5a3a3a); 
  color: #ff8a8a; 
  border-color: #ff5a5a;
  box-shadow: 0 4px 12px rgba(255, 90, 90, 0.3);
}

.history-item.low { 
  background: linear-gradient(135deg, #2a2a4a, #3a3a5a); 
  color: #8a8aff; 
  border-color: #4a6eff;
  box-shadow: 0 4px 12px rgba(74, 110, 255, 0.3);
}

.history-item.correct { 
  background: linear-gradient(135deg, #2a4a2a, #3a6a3a); 
  color: #8aff8a; 
  border-color: #4aff4a;
  transform: scale(1.1);
  box-shadow: 0 4px 16px rgba(74, 255, 74, 0.4);
  animation: correctPulse 0.6s ease;
}

@keyframes correctPulse {
  0%, 100% { transform: scale(1.1); }
  50% { transform: scale(1.2); }
}

#guess-input-area {
  display: flex;
  gap: 12px;
  align-items: center;
  background: rgba(26, 33, 46, 0.8);
  padding: 20px;
  border-radius: 60px;
  border: 2px solid #2a3a4a;
}

#guess-input {
  flex: 1;
  height: 60px;
  font-size: 28px;
  text-align: center;
  background: rgba(15, 26, 42, 0.8);
  border: 2px solid #2a3a4a;
  border-radius: 40px;
  color: #fff;
  font-weight: 700;
  padding: 0 24px;
  transition: all 0.3s ease;
  -webkit-user-select: text;
  user-select: text;
}

#guess-input:focus {
  outline: none;
  border-color: #4a9eff;
  box-shadow: 0 0 0 4px rgba(74, 158, 255, 0.2);
}

#guess-submit {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  border: none;
  background: linear-gradient(135deg, #2a6eff, #4a9eff);
  color: white;
  font-size: 20px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 8px 24px rgba(42, 110, 255, 0.4);
}

#guess-submit:hover {
  background: linear-gradient(135deg, #1a5eef, #3a8eff);
  transform: scale(1.1);
}

#guess-submit:disabled {
  opacity: 0.4;
  transform: scale(0.9);
  pointer-events: none;
  box-shadow: none;
}

#new-game-btn {
  padding: 18px 36px;
  background: linear-gradient(135deg, #2a3a4a, #3a4a5a);
  border: 2px solid #4a9eff;
  border-radius: 50px;
  color: white;
  font-size: 20px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
  margin-top: 10px;
}

#new-game-btn:hover {
  background: linear-gradient(135deg, #1a2a3a, #2a3a4a);
  border-color: #ffaa2a;
  transform: translateY(-3px);
  box-shadow: 0 8px 24px rgba(255, 170, 42, 0.4);
}

#guess-feedback {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 100px;
  font-weight: 800;
  text-shadow: 0 4px 40px currentColor;
  z-index: 1000;
  pointer-events: none;
  animation: feedbackFloat 1s ease-out forwards;
  opacity: 0;
}

@keyframes feedbackFloat {
  0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
  20% { transform: translate(-50%, -50%) scale(1.3); opacity: 1; }
  40% { transform: translate(-50%, -50%) scale(1.1); }
  60% { transform: translate(-50%, -50%) scale(1.2); }
  100% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
}

#guess-feedback.high { color: #ff6b6b; }
#guess-feedback.low { color: #6b6bff; }
#guess-feedback.correct { color: #6bff6b; }

/* Mağaza Paneli - İki Sekmeli */
#shop-panel {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 92%;
  max-width: 500px;
  height: 85vh;
  background: rgba(15, 18, 25, 0.98);
  border: 2px solid #2a3a4a;
  border-radius: 32px;
  padding: 24px;
  z-index: 1000;
  box-shadow: 0 30px 60px rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(20px);
  display: none;
  overflow: hidden;
  flex-direction: column;
}

#shop-panel h2 {
  color: #e4e6f0;
  margin: 0 0 20px 0;
  text-align: center;
  font-size: 26px;
  font-weight: 700;
  flex-shrink: 0;
}

.shop-tabs {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  flex-shrink: 0;
}

.shop-tab {
  flex: 1;
  padding: 14px;
  background: rgba(26, 33, 46, 0.8);
  border: 2px solid #2a3a4a;
  border-radius: 16px;
  color: #b4c0d0;
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
}

.shop-tab.active {
  background: linear-gradient(135deg, #2a6eff, #4a9eff);
  border-color: #4a9eff;
  color: white;
  box-shadow: 0 4px 16px rgba(42, 110, 255, 0.3);
}

.shop-content {
  flex: 1;
  overflow: hidden;
  position: relative;
}

.shop-section {
  height: 100%;
  overflow-y: auto;
  padding-right: 50px;
  display: none;
}

.shop-section.active {
  display: block;
}

.shop-section::-webkit-scrollbar {
  width: 0;
  display: none;
}

.scroll-btn {
  position: absolute;
  right: 0;
  width: 44px;
  height: 44px;
  background: linear-gradient(135deg, #2a6eff, #4a9eff);
  border: none;
  border-radius: 50%;
  color: white;
  font-size: 20px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 16px rgba(42, 110, 255, 0.4);
  z-index: 10;
  display: flex;
  align-items: center;
  justify-content: center;
}

.scroll-btn:hover {
  transform: scale(1.1);
  box-shadow: 0 8px 24px rgba(42, 110, 255, 0.5);
}

.scroll-btn.up {
  top: 10px;
}

.scroll-btn.down {
  bottom: 10px;
}

.shop-item {
  background: rgba(26, 33, 46, 0.8);
  border: 2px solid #2a3a4a;
  border-radius: 24px;
  padding: 20px;
  display: flex;
  align-items: center;
  gap: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-bottom: 14px;
}

.shop-item:hover {
  background: rgba(42, 110, 255, 0.1);
  border-color: #4a9eff;
  transform: translateX(8px);
  box-shadow: 0 8px 24px rgba(74, 158, 255, 0.2);
}

.shop-item.disabled {
  opacity: 0.5;
  pointer-events: none;
  filter: grayscale(0.8);
}

.shop-item-preview {
  width: 64px;
  height: 64px;
  border-radius: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32px;
  flex-shrink: 0;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
}

.shop-item-info {
  flex: 1;
}

.shop-item-info h3 {
  margin: 0 0 6px 0;
  color: #e4e6f0;
  font-size: 17px;
  font-weight: 700;
}

.shop-item-info p {
  margin: 0;
  color: #8892a6;
  font-size: 13px;
}

.shop-item-price {
  font-size: 22px;
  font-weight: 800;
  color: #ffaa2a;
  display: flex;
  align-items: center;
  gap: 4px;
  flex-shrink: 0;
}

#shop-close {
  width: 100%;
  padding: 18px;
  background: linear-gradient(135deg, #2a3a4a, #3a4a5a);
  border: 2px solid #4a5a6a;
  border-radius: 30px;
  color: white;
  font-size: 18px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-top: 16px;
  flex-shrink: 0;
}

#shop-close:hover {
  background: linear-gradient(135deg, #ff5a5a, #ff3a3a);
  border-color: #ff8a8a;
  transform: translateY(-2px);
}

/* Envanter Paneli */
#inventory-panel {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 92%;
  max-width: 500px;
  height: 85vh;
  background: rgba(15, 18, 25, 0.98);
  border: 2px solid #2a3a4a;
  border-radius: 32px;
  padding: 24px;
  z-index: 1000;
  box-shadow: 0 30px 60px rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(20px);
  display: none;
  flex-direction: column;
  overflow: hidden;
}

#inventory-panel h2 {
  color: #e4e6f0;
  margin: 0 0 20px 0;
  text-align: center;
  font-size: 26px;
  font-weight: 700;
  flex-shrink: 0;
}

#inventory-grid {
  flex: 1;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 14px;
  overflow-y: auto;
  padding-right: 50px;
  position: relative;
}

.inventory-item {
  background: rgba(26, 33, 46, 0.8);
  border: 3px solid #2a3a4a;
  border-radius: 20px;
  padding: 16px 8px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  aspect-ratio: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.inventory-item:hover {
  background: rgba(42, 110, 255, 0.15);
  border-color: #4a9eff;
  transform: translateY(-4px);
  box-shadow: 0 8px 24px rgba(74, 158, 255, 0.2);
}

.inventory-item.active {
  border-color: #4aff4a;
  box-shadow: 0 0 24px rgba(74, 255, 74, 0.4);
  animation: activePulse 2s infinite;
}

@keyframes activePulse {
  0%, 100% { box-shadow: 0 0 24px rgba(74, 255, 74, 0.4); }
  50% { box-shadow: 0 0 40px rgba(74, 255, 74, 0.7); }
}

.inventory-item-preview {
  width: 50px;
  height: 50px;
  border-radius: 25px;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
}

.inventory-item-name {
  font-size: 12px;
  color: #e4e6f0;
  font-weight: 700;
  line-height: 1.2;
}

.inventory-item-badge {
  position: absolute;
  top: -8px;
  right: -8px;
  background: linear-gradient(135deg, #4aff4a, #6aff6a);
  color: #0a0c12;
  width: 28px;
  height: 28px;
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  font-weight: 800;
  box-shadow: 0 4px 12px rgba(74, 255, 74, 0.4);
  animation: badgePulse 1.5s infinite;
}

@keyframes badgePulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

#inventory-close {
  width: 100%;
  padding: 18px;
  background: linear-gradient(135deg, #2a3a4a, #3a4a5a);
  border: 2px solid #4a5a6a;
  border-radius: 30px;
  color: white;
  font-size: 18px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-top: 16px;
  flex-shrink: 0;
}

#inventory-close:hover {
  background: linear-gradient(135deg, #ff5a5a, #ff3a3a);
  border-color: #ff8a8a;
  transform: translateY(-2px);
}

/* Admin Panelleri */
#ban-panel, #warn-panel {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 90%;
  max-width: 420px;
  background: rgba(15, 18, 25, 0.98);
  border-radius: 32px;
  padding: 28px;
  z-index: 1002;
  display: none;
  box-shadow: 0 30px 60px rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(20px);
  animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

#ban-panel {
  border: 3px solid #ff5a5a;
}

#warn-panel {
  border: 3px solid #ffaa2a;
}

#ban-panel h3 {
  color: #ff8a8a;
  margin: 0 0 20px 0;
  font-size: 24px;
  font-weight: 700;
  text-align: center;
}

#warn-panel h3 {
  color: #ffcc4a;
  margin: 0 0 20px 0;
  font-size: 24px;
  font-weight: 700;
  text-align: center;
}

#ban-user, #warn-user {
  color: #4a9eff;
  font-weight: 800;
  font-size: 20px;
  display: block;
  text-align: center;
  margin: 10px 0;
}

select, textarea {
  width: 100%;
  padding: 16px 20px;
  margin: 12px 0;
  background: rgba(26, 33, 46, 0.8);
  border: 2px solid #2a3a4a;
  border-radius: 16px;
  color: white;
  font-size: 15px;
  font-family: inherit;
  transition: all 0.3s ease;
}

select:focus, textarea:focus {
  outline: none;
  border-color: #4a9eff;
  box-shadow: 0 0 0 4px rgba(74, 158, 255, 0.2);
}

textarea {
  resize: none;
  height: 120px;
}

.ban-buttons, .warn-buttons {
  display: flex;
  gap: 12px;
  margin-top: 20px;
}

.ban-confirm, .warn-confirm {
  flex: 1;
  padding: 16px;
  background: linear-gradient(135deg, #ff5a5a, #ff3a3a);
  color: white;
  border: none;
  border-radius: 30px;
  font-weight: 700;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.warn-confirm {
  background: linear-gradient(135deg, #ffaa2a, #ff8a2a);
}

.ban-confirm:hover, .warn-confirm:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 24px rgba(255, 90, 90, 0.4);
}

.ban-cancel, .warn-cancel {
  flex: 1;
  padding: 16px;
  background: rgba(42, 58, 74, 0.8);
  color: white;
  border: none;
  border-radius: 30px;
  font-weight: 700;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.ban-cancel:hover, .warn-cancel:hover {
  background: rgba(26, 42, 58, 0.8);
  transform: translateY(-3px);
}

/* Geri Bildirim Paneli */
#feedback-panel {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 92%;
  max-width: 480px;
  background: rgba(15, 18, 25, 0.98);
  border: 2px solid #2a3a4a;
  border-radius: 32px;
  padding: 28px;
  z-index: 1001;
  display: none;
  box-shadow: 0 30px 60px rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(20px);
  animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

#feedback-panel h2 {
  color: #e4e6f0;
  margin: 0 0 10px 0;
  text-align: center;
  font-size: 26px;
  font-weight: 700;
}

#feedback-type {
  display: flex;
  gap: 10px;
  margin: 24px 0;
}

.feedback-type-btn {
  flex: 1;
  padding: 14px;
  background: rgba(26, 33, 46, 0.8);
  border: 2px solid #2a3a4a;
  border-radius: 30px;
  color: #b4c0d0;
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
}

.feedback-type-btn.active {
  background: linear-gradient(135deg, #2a6eff, #4a9eff);
  border-color: #4a9eff;
  color: white;
  box-shadow: 0 4px 16px rgba(42, 110, 255, 0.3);
}

.feedback-type-btn:hover {
  background: rgba(42, 58, 74, 0.8);
  color: #fff;
}

#feedback-text {
  width: 100%;
  height: 160px;
  background: rgba(26, 33, 46, 0.8);
  border: 2px solid #2a3a4a;
  border-radius: 24px;
  padding: 20px;
  color: white;
  font-size: 15px;
  resize: none;
  margin: 20px 0;
  font-family: inherit;
  transition: all 0.3s ease;
  -webkit-user-select: text;
  user-select: text;
}

#feedback-text:focus {
  outline: none;
  border-color: #4a9eff;
  box-shadow: 0 0 0 4px rgba(74, 158, 255, 0.2);
}

#feedback-submit {
  width: 100%;
  padding: 18px;
  background: linear-gradient(135deg, #2a6eff, #4a9eff);
  border: none;
  border-radius: 30px;
  color: white;
  font-size: 18px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-bottom: 12px;
  box-shadow: 0 4px 16px rgba(42, 110, 255, 0.3);
}

#feedback-submit:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 24px rgba(42, 110, 255, 0.4);
}

#feedback-close {
  width: 100%;
  padding: 16px;
  background: rgba(42, 58, 74, 0.8);
  border: none;
  border-radius: 30px;
  color: white;
  font-size: 17px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 700;
}

#feedback-close:hover {
  background: rgba(26, 42, 58, 0.8);
  transform: translateY(-2px);
}

#feedback-list {
  margin-top: 24px;
  max-height: 220px;
  overflow-y: auto;
  padding: 16px;
  background: rgba(26, 33, 46, 0.8);
  border-radius: 24px;
  display: none;
  border: 2px solid #2a3a4a;
}

.feedback-item {
  padding: 14px;
  border-bottom: 2px solid #2a3a4a;
  font-size: 14px;
  animation: slideIn 0.3s ease;
}

.feedback-item:last-child {
  border-bottom: none;
}

.feedback-header {
  display: flex;
  justify-content: space-between;
  color: #4a9eff;
  margin-bottom: 8px;
  font-weight: 700;
}

.feedback-type-badge {
  background: rgba(42, 58, 74, 0.8);
  color: #e4e6f0;
  padding: 6px 14px;
  border-radius: 30px;
  font-size: 12px;
  font-weight: 700;
}

/* AFK uyarı */
#afk-warning {
  position: fixed;
  top: 20px;
  right: 20px;
  background: linear-gradient(135deg, #ffaa2a, #ffcc4a);
  color: #0a0c12;
  padding: 16px 28px;
  border-radius: 40px;
  font-weight: 700;
  font-size: 15px;
  z-index: 1000;
  animation: slideInRight 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  display: none;
  border: 2px solid #ffdd6a;
  box-shadow: 0 8px 24px rgba(255, 170, 42, 0.5);
}

@keyframes slideInRight {
  from { transform: translateX(100%) scale(0.8); opacity: 0; }
  to { transform: translateX(0) scale(1); opacity: 1; }
}

.hidden {
  display: none !important;
}

.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  background: rgba(26, 33, 46, 0.98);
  color: #e4e6f0;
  padding: 18px 32px;
  border-radius: 40px;
  font-size: 16px;
  font-weight: 700;
  z-index: 2000;
  animation: slideInRight 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  border: 2px solid #2a3a4a;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(10px);
}

/* Scrollbar stilleri */
::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

::-webkit-scrollbar-track {
  background: #0f1219;
}

::-webkit-scrollbar-thumb {
  background: #2a3a4a;
  border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
  background: #3a4a5a;
}

/* Mobil optimizasyonları */
@media (max-width: 480px) {
  #topbar {
    height: 60px;
  }
  
  #points-display {
    left: 60px;
    padding: 6px 12px;
    font-size: 12px;
  }
  
  #shop-btn, #inventory-btn {
    display: none;
  }
  
  .game-sidebar {
    max-height: 25%;
  }
  
  #guess-submit {
    width: 80px;
    height: 80px;
    font-size: 16px;
  }
  
  #inventory-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* Joystick için özel stiller */
.joystick-container {
  position: absolute;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  width: 160px;
  height: 160px;
  background: rgba(26, 33, 46, 0.4);
  border: 3px solid rgba(74, 158, 255, 0.3);
  border-radius: 50%;
  touch-action: none;
  z-index: 100;
}

.joystick-base {
  position: absolute;
  inset: 0;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(42, 110, 255, 0.1) 0%, transparent 70%);
}

.joystick-stick {
  position: absolute;
  width: 70px;
  height: 70px;
  background: linear-gradient(135deg, #2a6eff, #4a9eff);
  border-radius: 50%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  box-shadow: 0 6px 24px rgba(42, 110, 255, 0.5);
  cursor: grab;
  touch-action: none;
}

.joystick-stick:active {
  cursor: grabbing;
  transform: translate(-50%, -50%) scale(1.1);
}

/* Araba oyunu özel efektler */
.car-game-hud {
  position: absolute;
  top: 20px;
  left: 20px;
  right: 20px;
  display: flex;
  justify-content: space-between;
  pointer-events: none;
}

.car-game-stat {
  background: rgba(0, 0, 0, 0.6);
  padding: 12px 20px;
  border-radius: 30px;
  color: #fff;
  font-weight: 700;
  font-size: 18px;
  border: 2px solid #4a9eff;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
}

/* Yılan oyunu özel efektler */
.snake-game-hud {
  position: absolute;
  top: 20px;
  left: 20px;
  right: 20px;
  display: flex;
  justify-content: space-between;
  pointer-events: none;
}

.snake-score {
  background: rgba(0, 0, 0, 0.6);
  padding: 12px 24px;
  border-radius: 30px;
  color: #4aff4a;
  font-weight: 800;
  font-size: 20px;
  border: 2px solid #4aff4a;
  text-shadow: 0 0 10px #4aff4a;
}

/* Oda bekleme ekranı */
.waiting-overlay {
  position: absolute;
  inset: 0;
  background: rgba(10, 12, 18, 0.95);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  border-radius: 20px;
  z-index: 50;
  backdrop-filter: blur(10px);
}

.waiting-overlay h2 {
  color: #e4e6f0;
  margin-bottom: 30px;
  font-size: 28px;
  font-weight: 700;
  text-align: center;
}

.player-slots {
  display: flex;
  flex-direction: column;
  gap: 16px;
  width: 80%;
  max-width: 400px;
}

.player-slot {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 18px 24px;
  background: rgba(26, 33, 46, 0.8);
  border: 3px solid #2a3a4a;
  border-radius: 20px;
  font-size: 18px;
  font-weight: 700;
  transition: all 0.3s ease;
}

.player-slot.filled {
  border-color: #4a9eff;
  background: rgba(42, 110, 255, 0.1);
}

.player-slot.ready {
  border-color: #4aff4a;
  background: rgba(74, 255, 74, 0.1);
  animation: readyPulse 1.5s infinite;
}

@keyframes readyPulse {
  0%, 100% { box-shadow: 0 0 0 0 rgba(74, 255, 74, 0.4); }
  50% { box-shadow: 0 0 20px 5px rgba(74, 255, 74, 0.2); }
}

.ready-btn {
  margin-top: 30px;
  padding: 18px 56px;
  background: linear-gradient(135deg, #2a6eff, #4a9eff);
  border: none;
  border-radius: 40px;
  color: white;
  font-weight: 800;
  font-size: 20px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 8px 24px rgba(42, 110, 255, 0.4);
}

.ready-btn:hover {
  transform: translateY(-4px) scale(1.05);
  box-shadow: 0 12px 32px rgba(42, 110, 255, 0.5);
}

.ready-btn.ready {
  background: linear-gradient(135deg, #4aff4a, #6aff6a);
  box-shadow: 0 8px 24px rgba(74, 255, 74, 0.4);
}

.leave-btn {
  margin-top: 16px;
  padding: 14px 40px;
  background: rgba(255, 90, 90, 0.2);
  border: 2px solid #ff5a5a;
  border-radius: 30px;
  color: #ff8a8a;
  font-weight: 700;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.leave-btn:hover {
  background: #ff5a5a;
  color: white;
  transform: translateY(-2px);
}
</style>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>

<body>

<audio id="notify" src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmFgU7k9n1unEiBC13yO/eizEIHWq+8+OWT" preload="auto"></audio>

<!-- Login Ekranı -->
<div id="login">
  <img id="pfp-preview" src="" alt="Profil fotoğrafı">
  <input type="text" id="nameInput" placeholder="Kullanıcı adı" autocomplete="off">
  <input type="password" id="codeInput" placeholder="Kod" autocomplete="off">
  <input type="file" id="pfpInput" accept="image/*" onchange="previewPFP()">
  <button onclick="enter()">Giriş Yap</button>
  <div id="login-error"></div>
</div>

<!-- AFK Uyarı -->
<div id="afk-warning">⚠️ 2 dakika hareketsizsin!</div>

<!-- Menü butonu -->
<button id="menu-btn" onclick="toggleMenu()">☰</button>

<!-- Sidebar overlay -->
<div id="sidebar-overlay" onclick="closeMenu()"></div>

<!-- Sidebar -->
<div id="sidebar">
  <div id="sidebar-header">
    <h3>MENÜ</h3>
  </div>
  <button class="sidebar-btn active" onclick="switchScreen('chat')" id="btn-chat">
    <i>💬</i> Sohbet
  </button>
  <button class="sidebar-btn" onclick="switchScreen('altun')" id="btn-altun">
    <i>🤖</i> Altun.ai
  </button>
  <button class="sidebar-btn" onclick="switchScreen('snake')" id="btn-snake">
    <i>🐍</i> Yılan Oyunu
  </button>
  <button class="sidebar-btn" onclick="switchScreen('car')" id="btn-car">
    <i>🏎️</i> Araba Yarışı
  </button>
  <button class="sidebar-btn" onclick="switchScreen('tictactoe')" id="btn-tictactoe">
    <i>⭕</i> XOX Oyunu
  </button>
  <button class="sidebar-btn" onclick="switchScreen('guess')" id="btn-guess">
    <i>🔢</i> Sayı Tahmin
  </button>
  <button class="sidebar-btn" onclick="openShop()" id="btn-shop">
    <i>🛒</i> Mağaza
  </button>
  <button class="sidebar-btn" onclick="openInventory()" id="btn-inventory">
    <i>🎒</i> Envanter
  </button>
  <button class="sidebar-btn" onclick="openFeedback()" id="btn-feedback">
    <i>📝</i> Geri Bildirim
  </button>
</div>

<!-- Ana İçerik -->
<div id="main-content">
  
  <!-- Sohbet Ekranı -->
  <div id="chat-screen">
    <div id="topbar">
      <div id="admin-badge">👑 ADMIN</div>
      <div id="points-display">💰 <span id="user-points">0</span></div>
      <div style="font-weight: 700; font-size: 18px;">7/D Sohbet</div>
      <button id="inventory-btn" onclick="openInventory()">🎒</button>
      <button id="shop-btn" onclick="openShop()">🛒</button>
      <button id="onlineBtn" onclick="toggleOnline()">👥 <span id="online-count">0</span></button>
    </div>

    <div id="onlinePanel"></div>
    
    <div id="typing-indicator">
      <span id="typing-user"></span> yazıyor
      <span class="typing-dots"><span></span><span></span><span></span></span>
    </div>

    <div id="chat"></div>

    <div id="inputBar">
      <input type="text" id="text" placeholder="Mesaj yaz..." oninput="onTyping()">
      <label for="imgInput" class="media-btn">📷</label>
      <input type="file" id="imgInput" accept="image/*">
      <label for="videoInput" class="media-btn">🎥</label>
      <input type="file" id="videoInput" accept="video/*">
      <button class="send-btn" onclick="send()">➤</button>
    </div>
  </div>

  <!-- Altun.ai Ekranı -->
  <div id="altun-screen" class="hidden">
    <div id="altun-header">Altun.ai Asistan</div>
    <div id="altun-messages"></div>
    <div id="altun-input-area">
      <input type="text" id="altun-input" placeholder="Bir şey sor..." />
      <button class="altun-btn" onclick="sendToAltun()">➤</button>
    </div>
  </div>

  <!-- Yılan Oyunu -->
  <div id="snake-screen" class="hidden game-screen">
    <div class="game-header">
      <h2>🐍 Yılan Oyunu</h2>
      <div>
        <input type="text" id="new-snake-room" placeholder="Oda adı" style="padding: 10px 16px; border-radius: 30px; border: 2px solid #2a3a4a; background: #1a212e; color: white; margin-right: 10px; width: 150px;">
        <button onclick="createSnakeRoom()" style="padding: 10px 20px; background: linear-gradient(135deg, #2a6eff, #4a9eff); border: none; border-radius: 30px; color: white; font-weight: 700; cursor: pointer;">Oda Oluştur</button>
      </div>
    </div>
    
    <div class="server-selector">
      <button class="server-btn active" onclick="switchServer('snake', 1)">🖥️ Server 1</button>
      <button class="server-btn" onclick="switchServer('snake', 2)">🖥️ Server 2</button>
    </div>
    
    <div class="game-container">
      <div class="game-sidebar">
        <h3>📋 Aktif Odalar</h3>
        <div class="rooms-list" id="snake-rooms-list"></div>
      </div>
      
      <div class="game-area" id="snake-game-area">
        <canvas id="snake-canvas" width="600" height="600"></canvas>
        
        <div class="joystick-container" id="snake-joystick" style="display: none;">
          <div class="joystick-base"></div>
          <div class="joystick-stick" id="snake-joystick-stick"></div>
        </div>
        
        <div class="waiting-overlay" id="snake-waiting">
          <h2 id="snake-waiting-title">Bekleme Odası</h2>
          <div class="player-slots">
            <div class="player-slot" id="snake-player1-slot">
              <span>🐍 Oyuncu 1: <span id="snake-player1">Boş</span></span>
              <span id="snake-player1-status" class="not-ready">Bekliyor</span>
            </div>
          </div>
          <button class="ready-btn" id="snake-ready-btn" onclick="toggleSnakeReady()">HAZIR OL</button>
          <button class="leave-btn" onclick="leaveSnakeRoom()">ODADAN ÇIK</button>
        </div>
        
        <div class="snake-game-hud" id="snake-hud" style="display: none;">
          <div class="snake-score">🍎 <span id="snake-score">0</span></div>
          <div class="snake-score">🏆 <span id="snake-highscore">0</span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Araba Yarışı -->
  <div id="car-screen" class="hidden game-screen">
    <div class="game-header">
      <h2>🏎️ Araba Yarışı</h2>
      <div>
        <input type="text" id="new-car-room" placeholder="Oda adı" style="padding: 10px 16px; border-radius: 30px; border: 2px solid #2a3a4a; background: #1a212e; color: white; margin-right: 10px; width: 150px;">
        <button onclick="createCarRoom()" style="padding: 10px 20px; background: linear-gradient(135deg, #2a6eff, #4a9eff); border: none; border-radius: 30px; color: white; font-weight: 700; cursor: pointer;">Oda Oluştur</button>
      </div>
    </div>
    
    <div class="server-selector">
      <button class="server-btn active" onclick="switchServer('car', 1)">🖥️ Server 1</button>
      <button class="server-btn" onclick="switchServer('car', 2)">🖥️ Server 2</button>
    </div>
    
    <div class="game-container">
      <div class="game-sidebar">
        <h3>📋 Aktif Odalar</h3>
        <div class="rooms-list" id="car-rooms-list"></div>
      </div>
      
      <div class="game-area" id="car-game-area">
        <canvas id="car-canvas" width="400" height="700"></canvas>
        
        <div class="joystick-container" id="car-joystick" style="display: none;">
          <div class="joystick-base"></div>
          <div class="joystick-stick" id="car-joystick-stick"></div>
        </div>
        
        <div class="waiting-overlay" id="car-waiting">
          <h2 id="car-waiting-title">Bekleme Odası</h2>
          <div class="player-slots">
            <div class="player-slot" id="car-player1-slot">
              <span>🏎️ Yarışçı 1: <span id="car-player1">Boş</span></span>
              <span id="car-player1-status" class="not-ready">Bekliyor</span>
            </div>
            <div class="player-slot" id="car-player2-slot">
              <span>🏎️ Yarışçı 2: <span id="car-player2">Boş</span></span>
              <span id="car-player2-status" class="not-ready">Bekliyor</span>
            </div>
          </div>
          <button class="ready-btn" id="car-ready-btn" onclick="toggleCarReady()">HAZIR OL</button>
          <button class="leave-btn" onclick="leaveCarRoom()">ODADAN ÇIK</button>
        </div>
        
        <div class="car-game-hud" id="car-hud" style="display: none;">
          <div class="car-game-stat">🏆 <span id="car-score">0</span></div>
          <div class="car-game-stat">⚡ <span id="car-speed">0</span> km/h</div>
        </div>
      </div>
    </div>
  </div>

  <!-- XOX Oyunu -->
  <div id="tictactoe-screen" class="hidden game-screen">
    <div class="game-header">
      <h2>⭕ XOX Oyunu</h2>
      <div>
        <input type="text" id="new-tictactoe-room" placeholder="Oda adı" style="padding: 10px 16px; border-radius: 30px; border: 2px solid #2a3a4a; background: #1a212e; color: white; margin-right: 10px; width: 150px;">
        <button onclick="createTictactoeRoom()" style="padding: 10px 20px; background: linear-gradient(135deg, #2a6eff, #4a9eff); border: none; border-radius: 30px; color: white; font-weight: 700; cursor: pointer;">Oda Oluştur</button>
      </div>
    </div>
    
    <div class="server-selector">
      <button class="server-btn active" onclick="switchServer('tictactoe', 1)">🖥️ Server 1</button>
      <button class="server-btn" onclick="switchServer('tictactoe', 2)">🖥️ Server 2</button>
    </div>
    
    <div class="game-container">
      <div class="game-sidebar">
        <h3>📋 Aktif Odalar</h3>
        <div class="rooms-list" id="tictactoe-rooms-list"></div>
      </div>
      
      <div class="game-area">
        <div id="tictactoe-board" style="display: none;">
          <div class="tictactoe-cell" data-index="0" onclick="makeTictactoeMove(0)"></div>
          <div class="tictactoe-cell" data-index="1" onclick="makeTictactoeMove(1)"></div>
          <div class="tictactoe-cell" data-index="2" onclick="makeTictactoeMove(2)"></div>
          <div class="tictactoe-cell" data-index="3" onclick="makeTictactoeMove(3)"></div>
          <div class="tictactoe-cell" data-index="4" onclick="makeTictactoeMove(4)"></div>
          <div class="tictactoe-cell" data-index="5" onclick="makeTictactoeMove(5)"></div>
          <div class="tictactoe-cell" data-index="6" onclick="makeTictactoeMove(6)"></div>
          <div class="tictactoe-cell" data-index="7" onclick="makeTictactoeMove(7)"></div>
          <div class="tictactoe-cell" data-index="8" onclick="makeTictactoeMove(8)"></div>
        </div>
        
        <div class="waiting-overlay" id="tictactoe-waiting">
          <h2 id="tictactoe-waiting-title">Bekleme Odası</h2>
          <div class="player-slots">
            <div class="player-slot" id="tictactoe-x-slot">
              <span>⭕ X Oyuncu: <span id="tictactoe-x">Boş</span></span>
              <span id="tictactoe-x-status" class="not-ready">Bekliyor</span>
            </div>
            <div class="player-slot" id="tictactoe-o-slot">
              <span>❌ O Oyuncu: <span id="tictactoe-o">Boş</span></span>
              <span id="tictactoe-o-status" class="not-ready">Bekliyor</span>
            </div>
          </div>
          <button class="ready-btn" id="tictactoe-ready-btn" onclick="toggleTictactoeReady()">HAZIR OL</button>
          <button class="leave-btn" onclick="leaveTictactoeRoom()">ODADAN ÇIK</button>
        </div>
        
        <div id="tictactoe-status" style="display: none; margin-top: 20px; font-size: 24px; font-weight: 700; color: #e4e6f0;"></div>
        <button onclick="resetTictactoe()" id="tictactoe-reset" style="display: none; margin-top: 16px; padding: 14px 32px; background: linear-gradient(135deg, #2a6eff, #4a9eff); border: none; border-radius: 30px; color: white; font-weight: 700; cursor: pointer;">Yeniden Başla</button>
      </div>
    </div>
  </div>

  <!-- Sayı Tahmin Oyunu -->
  <div id="guess-screen" class="hidden">
    <div id="guess-container">
      <div id="guess-scoreboard">
        <h2>🏆 SKOR TABLOSU</h2>
        <div id="score-list"></div>
      </div>
      
      <div id="guess-game-panel">
        <div id="guess-header">
          <h1>🔢 SAYI TAHMİN</h1>
          <div id="target-number">?</div>
          <div id="range-info">
            <span id="min-range">1</span> - <span id="max-range">100</span>
          </div>
        </div>
        
        <div id="guess-history">
          <h3>📜 TAHMİN GEÇMİŞİ</h3>
          <div class="history-list" id="history-list"></div>
        </div>
        
        <div id="guess-input-area">
          <input type="number" id="guess-input" placeholder="Sayı gir" min="1" max="100">
          <button id="guess-submit" onclick="makeGuess()">➤</button>
        </div>
        
        <button id="new-game-btn" onclick="startNewGuessGame()">🔄 YENİ OYUN</button>
      </div>
    </div>
    
    <div id="guess-feedback"></div>
  </div>
</div>

<!-- Mağaza Paneli -->
<div id="shop-panel">
  <h2>🛒 MAĞAZA</h2>
  
  <div class="shop-tabs">
    <button class="shop-tab active" onclick="switchShopTab('bubbles')">💬 Baloncuklar</button>
    <button class="shop-tab" onclick="switchShopTab('themes')">🎨 Temalar</button>
  </div>
  
  <div class="shop-content">
    <button class="scroll-btn up" onclick="scrollShop(-1)">▲</button>
    
    <div class="shop-section active" id="shop-bubbles">
      <!-- Baloncuklar buraya dinamik olarak eklenecek -->
    </div>
    
    <div class="shop-section" id="shop-themes">
      <!-- Temalar buraya dinamik olarak eklenecek -->
    </div>
    
    <button class="scroll-btn down" onclick="scrollShop(1)">▼</button>
  </div>
  
  <button id="shop-close" onclick="closeShop()">Kapat</button>
</div>

<!-- Envanter Paneli -->
<div id="inventory-panel">
  <h2>🎒 ENVANTERİM</h2>
  
  <button class="scroll-btn up" onclick="scrollInventory(-1)" style="top: 80px;">▲</button>
  
  <div id="inventory-grid">
    <!-- Envanter öğeleri buraya dinamik olarak eklenecek -->
  </div>
  
  <button class="scroll-btn down" onclick="scrollInventory(1)" style="bottom: 80px;">▼</button>
  
  <button id="inventory-close" onclick="closeInventory()">Kapat</button>
</div>

<!-- Ban Paneli -->
<div id="ban-panel">
  <h3>🚫 KULLANICIYI BANLA</h3>
  <p>Kullanıcı: <span id="ban-user"></span></p>
  
  <select id="ban-duration">
    <option value="5">5 dakika</option>
    <option value="30">30 dakika</option>
    <option value="60">1 saat</option>
    <option value="360">6 saat</option>
    <option value="1440">24 saat</option>
    <option value="10080">1 hafta</option>
    <option value="43200">1 ay</option>
    <option value="0">Süresiz</option>
  </select>
  
  <textarea id="ban-reason" placeholder="Ban sebebi..."></textarea>
  
  <div class="ban-buttons">
    <button class="ban-confirm" onclick="confirmBan()">BANLA</button>
    <button class="ban-cancel" onclick="closeBanPanel()">İptal</button>
  </div>
</div>

<!-- Uyarı Paneli -->
<div id="warn-panel">
  <h3>⚠️ KULLANICIYI UYAR</h3>
  <p>Kullanıcı: <span id="warn-user"></span></p>
  
  <textarea id="warn-reason" placeholder="Uyarı sebebi..."></textarea>
  
  <div class="warn-buttons">
    <button class="warn-confirm" onclick="confirmWarn()">UYAR</button>
    <button class="warn-cancel" onclick="closeWarnPanel()">İptal</button>
  </div>
</div>

<!-- Geri Bildirim Paneli -->
<div id="feedback-panel">
  <h2>📝 GERİ BİLDİRİM</h2>
  
  <div id="feedback-type">
    <button class="feedback-type-btn active" onclick="setFeedbackType('feedback')">💬 Geri Bildirim</button>
    <button class="feedback-type-btn" onclick="setFeedbackType('bug')">🐛 Hata</button>
    <button class="feedback-type-btn" onclick="setFeedbackType('suggestion')">💡 Öneri</button>
  </div>
  
  <textarea id="feedback-text" placeholder="Düşüncelerinizi yazın..."></textarea>
  
  <button id="feedback-submit" onclick="submitFeedback()">Gönder</button>
  <button id="feedback-close" onclick="closeFeedback()">Kapat</button>
  
  <div id="feedback-list"></div>
</div>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyBVMvgD3u-UT5dAk72pXqLub05qNPjqPW8",
  authDomain: "dsohbet.firebaseapp.com",
  databaseURL: "https://dsohbet-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "dsohbet"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Global Değişkenler
let username = "", role = "user", pfp = "";
let onlineRef;
let currentScreen = 'chat';
let userPoints = 0;
let purchasedStyles = ['default'];
let currentStyle = 'default';
let purchasedThemes = ['default'];
let currentTheme = 'default';
let typingTimeout = null;
let mutedUsers = {};
let bannedUsers = {};

// Server sistemi
let currentServers = {
  snake: 1,
  car: 1,
  tictactoe: 1
};

// Oyun değişkenleri
let gameRooms = {
  snake: { current: null, player: null, ready: false, listener: null },
  car: { current: null, player: null, ready: false, listener: null },
  tictactoe: { current: null, player: null, ready: false, listener: null }
};

// Sayı Tahmin Değişkenleri
let guessTarget = Math.floor(Math.random() * 100) + 1;
let guessMin = 1, guessMax = 100;
let guessAttempts = 0;
let guessScore = 0;
let guessGameActive = true;
let guessPlayers = {};

// Geri Bildirim
let currentFeedbackType = 'feedback';

// AFK
let lastActivityTime = Date.now();
let afkKickTimer = null;
const AFK_WARNING = 90000;
const AFK_LIMIT = 120000;

// Admin için geçici değişken
let targetBanUser = '';
let targetWarnUser = '';

// Stil ve Tema tanımlamaları
const STYLE_DEFINITIONS = {
  'default': { name: 'Varsayılan', emoji: '💬', price: 0, color: '#1a212e', type: 'bubble' },
  'green': { name: 'Yeşil Enerji', emoji: '💚', price: 200, color: 'linear-gradient(135deg, #1a4a2a, #0a3a1a)', type: 'bubble' },
  'rgb': { name: 'RGB Akış', emoji: '🌈', price: 300, color: 'linear-gradient(135deg, #ff0066, #6600ff)', type: 'bubble' },
  'gold': { name: 'Altın', emoji: '👑', price: 500, color: 'linear-gradient(135deg, #4a3a1a, #8a6a2a)', type: 'bubble' },
  'ocean': { name: 'Okyanus', emoji: '🌊', price: 350, color: 'linear-gradient(135deg, #0a3a5a, #1a6a9a)', type: 'bubble' },
  'fire': { name: 'Ateş', emoji: '🔥', price: 400, color: 'linear-gradient(135deg, #4a1a0a, #8a2a1a)', type: 'bubble' },
  'ice': { name: 'Buz', emoji: '❄️', price: 400, color: 'linear-gradient(135deg, #0a2a4a, #1a4a6a)', type: 'bubble' },
  'purple': { name: 'Mor', emoji: '💜', price: 350, color: 'linear-gradient(135deg, #2a0a4a, #4a1a6a)', type: 'bubble' },
  'neon': { name: 'Neon', emoji: '⚡', price: 600, color: '#0a0a0a', type: 'bubble' },
  'sunset': { name: 'Gün Batımı', emoji: '🌅', price: 450, color: 'linear-gradient(135deg, #ff5a4a, #ff8a4a)', type: 'bubble' },
  'matrix': { name: 'Matrix', emoji: '🖥️', price: 550, color: '#000', type: 'bubble' },
  'blackwhite': { name: 'Siyah Beyaz', emoji: '⚫⚪', price: 1000, color: 'linear-gradient(135deg, #1a1a1a, #ffffff)', type: 'bubble' }
};

const THEME_DEFINITIONS = {
  'default': { name: 'Koyu Mod', emoji: '🌙', price: 0, bg: '#0a0c12' },
  'light': { name: 'Açık Mod', emoji: '☀️', price: 300, bg: '#f0f2f5' },
  'neon': { name: 'Neon Şehir', emoji: '🌃', price: 500, bg: 'linear-gradient(45deg, #0a0a1a, #1a0a2a)' },
  'forest': { name: 'Orman', emoji: '🌲', price: 400, bg: 'linear-gradient(45deg, #0a1a0a, #1a2a1a)' },
  'space': { name: 'Uzay', emoji: '🚀', price: 600, bg: 'linear-gradient(45deg, #0a0a1a, #000)' },
  'cyberpunk': { name: 'Cyberpunk', emoji: '🤖', price: 700, bg: 'linear-gradient(45deg, #1a0a1a, #2a1a3a)' }
};

// Sayfa kaymasını engelle
document.body.addEventListener('touchmove', function(e) {
  if (!e.target.closest('#chat') && !e.target.closest('#altun-messages') && !e.target.closest('#guess-container')) {
    e.preventDefault();
  }
}, { passive: false });

// Menü
window.toggleMenu = () => {
  document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('sidebar-overlay').classList.toggle('show');
}

window.closeMenu = () => {
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sidebar-overlay').classList.remove('show');
}

// Server değiştirme
window.switchServer = (game, serverNum) => {
  // Odadan çık
  if (gameRooms[game].current) {
    leaveGameRoom(game);
  }
  
  currentServers[game] = serverNum;
  
  // Butonları güncelle
  const screen = document.getElementById(game + '-screen');
  screen.querySelectorAll('.server-btn').forEach((btn, idx) => {
    btn.classList.toggle('active', idx === serverNum - 1);
  });
  
  // Listeyi yenile
  if (game === 'snake') listenSnakeRooms();
  else if (game === 'car') listenCarRooms();
  else if (game === 'tictactoe') listenTictactoeRooms();
  
  showNotification(`🖥️ Server ${serverNum}'e geçildi!`);
}

// Ekran değiştirme - Otomatik oda kontrolü
window.switchScreen = (screen) => {
  updateActivity();
  
  // Eğer bir oda aktifse ve sohbete geçiyorsa, odadan çıkma, sadece görünümü değiştir
  const wasInGame = ['snake', 'car', 'tictactoe'].includes(currentScreen);
  const goingToChat = screen === 'chat';
  
  currentScreen = screen;
  
  document.querySelectorAll('.sidebar-btn').forEach(btn => btn.classList.remove('active'));
  document.getElementById('btn-' + screen).classList.add('active');
  
  // Tüm ekranları gizle
  document.getElementById('chat-screen').classList.add('hidden');
  document.getElementById('altun-screen').classList.add('hidden');
  document.getElementById('snake-screen').classList.add('hidden');
  document.getElementById('car-screen').classList.add('hidden');
  document.getElementById('tictactoe-screen').classList.add('hidden');
  document.getElementById('guess-screen').classList.add('hidden');
  
  // Seçilen ekranı göster
  document.getElementById(screen + '-screen').classList.remove('hidden');
  
  // Oyun init
  if (screen === 'altun') loadAltunHistory();
  else if (screen === 'snake') initSnake();
  else if (screen === 'car') initCar();
  else if (screen === 'tictactoe') initTictactoe();
  else if (screen === 'guess') initGuessGame();
  
  closeMenu();
}

// Profil fotoğrafı preview
window.previewPFP = () => {
  const file = document.getElementById('pfpInput').files[0];
  const preview = document.getElementById('pfp-preview');
  if (file) {
    const reader = new FileReader();
    reader.onload = e => { 
      preview.src = e.target.result; 
      preview.style.display = 'block'; 
    };
    reader.readAsDataURL(file);
  }
}

// AFK
function startAfkMonitoring() {
  if (afkKickTimer) clearInterval(afkKickTimer);
  afkKickTimer = setInterval(() => {
    const afkTime = Date.now() - lastActivityTime;
    if (afkTime > AFK_WARNING && afkTime < AFK_LIMIT) {
      document.getElementById('afk-warning').style.display = 'block';
    } else if (afkTime >= AFK_LIMIT) {
      document.getElementById('afk-warning').style.display = 'none';
      if (onlineRef) onlineRef.remove();
      Object.keys(gameRooms).forEach(game => {
        if (gameRooms[game].current) leaveGameRoom(game);
      });
      alert('2 dakika hareketsiz kaldığınız için çıkış yapıldı!');
      location.reload();
    }
  }, 1000);
}

function updateActivity() {
  lastActivityTime = Date.now();
  document.getElementById('afk-warning').style.display = 'none';
}

['mousedown', 'mousemove', 'keydown', 'touchstart', 'touchmove'].forEach(ev => {
  document.addEventListener(ev, updateActivity);
});

// Giriş
window.enter = () => {
  username = document.getElementById('nameInput').value.trim();
  const code = document.getElementById('codeInput').value.trim();
  const errorDiv = document.getElementById('login-error');
  
  if (!username) { 
    errorDiv.textContent = "İsim girmelisin!"; 
    return; 
  }
  
  if (!code) {
    errorDiv.textContent = "Kod girmelisin!";
    return;
  }
  
  if (code === "deop" || code === "kmja" || code === "Alex") {
    if (code === "deop") { 
      role = "admin"; 
      document.getElementById('admin-badge').style.display = 'block';
    } else { 
      role = "user"; 
    }
  } else {
    errorDiv.textContent = "Geçersiz kod!";
    return;
  }

  const file = document.getElementById('pfpInput').files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = e => { 
      pfp = e.target.result; 
      setupPresence(); 
    };
    reader.readAsDataURL(file);
  } else {
    pfp = "https://ui-avatars.com/api/?name=" + encodeURIComponent(username) + "&background=2a6eff&color=fff&size=128";
    setupPresence();
  }

  document.getElementById('login').style.display = "none";
  
  loadUserData();
  updateActivity();
  startAfkMonitoring();

  listenMessages();
  listenOnline();
  listenTyping();
}

// Presence
function setupPresence() {
  onlineRef = db.ref("online/" + username);
  onlineRef.set({ name: username, role: role, pfp: pfp, lastActive: Date.now() });
  setInterval(() => { if (onlineRef) onlineRef.update({ lastActive: Date.now() }); }, 30000);
  onlineRef.onDisconnect().remove();
}

// Online listesi
function listenOnline() {
  db.ref("online").on('value', (snap) => {
    const onlinePanel = document.getElementById('onlinePanel');
    onlinePanel.innerHTML = "";
    let count = 0;
    
    snap.forEach(child => {
      const u = child.val();
      count++;
      
      const div = document.createElement("div");
      div.className = "userItem";
      
      const pfpImg = document.createElement("img");
      pfpImg.className = "user-pfp";
      pfpImg.src = u.pfp;
      
      const infoDiv = document.createElement("div");
      infoDiv.className = "user-info";
      infoDiv.textContent = u.name + (u.role === "admin" ? " 👑" : "");
      
      div.appendChild(pfpImg);
      div.appendChild(infoDiv);
      
      // Admin aksiyonları
      if (role === 'admin' && u.name !== username) {
        const actions = document.createElement('div');
        actions.className = 'admin-actions';
        actions.innerHTML = `
          <button onclick="showBanPanel('${u.name}')">🚫 Ban</button>
          <button onclick="showWarnPanel('${u.name}')">⚠️ Uyar</button>
          <button onclick="muteUser('${u.name}')">🔇 Mute</button>
          <button onclick="deleteUserMessages('${u.name}')">🗑️ Sil</button>
        `;
        div.appendChild(actions);
      }
      
      onlinePanel.appendChild(div);
    });
    
    document.getElementById('online-count').textContent = count;
  });
}

// Yazıyor
function listenTyping() {
  db.ref('typing').on('value', (snap) => {
    const data = snap.val() || {};
    const now = Date.now();
    const typingUsers = Object.keys(data).filter(id => id !== username && data[id] > now - 3000);
    
    const indicator = document.getElementById('typing-indicator');
    const userSpan = document.getElementById('typing-user');
    
    if (typingUsers.length > 0) {
      if (typingUsers.length === 1) userSpan.textContent = typingUsers[0];
      else if (typingUsers.length === 2) userSpan.textContent = typingUsers.join(' ve ');
      else userSpan.textContent = 'Birkaç kişi';
      indicator.style.display = 'flex';
    } else {
      indicator.style.display = 'none';
    }
  });
}

window.onTyping = () => {
  if (!username) return;
  if (typingTimeout) clearTimeout(typingTimeout);
  db.ref(`typing/${username}`).set(Date.now());
  typingTimeout = setTimeout(() => db.ref(`typing/${username}`).remove(), 3000);
}

// Mesajları dinle
function listenMessages() {
  db.ref("messages").on('child_added', (snap) => {
    renderMessage(snap.val(), snap.key);
    const notify = document.getElementById('notify');
    notify.currentTime = 0;
    notify.play().catch(() => {});
  });
  
  // Silinen mesajları dinle
  db.ref("messages").on('child_removed', (snap) => {
    // Mesajı DOM'dan kaldır
    const msgDiv = document.querySelector(`[data-key="${snap.key}"]`);
    if (msgDiv) {
      msgDiv.style.animation = 'fadeOut 0.3s ease forwards';
      setTimeout(() => msgDiv.remove(), 300);
    }
  });
}

// Mesaj gönder
window.send = () => {
  updateActivity();
  
  if (bannedUsers[username] && bannedUsers[username].until > Date.now()) {
    showNotification(`🚫 Banlandınız! Sebep: ${bannedUsers[username].reason}`);
    return;
  }
  
  if (mutedUsers[username] && mutedUsers[username] > Date.now()) {
    const remaining = Math.ceil((mutedUsers[username] - Date.now())/60000);
    showNotification(`🔇 Susturuldunuz! Kalan: ${remaining} dk`);
    return;
  }
  
  const text = document.getElementById('text').value.trim();
  const imgFile = document.getElementById('imgInput').files[0];
  const videoFile = document.getElementById('videoInput').files[0];

  if (!text && !imgFile && !videoFile) return;

  db.ref(`typing/${username}`).remove();
  
  const now = new Date();
  const timeStr = now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0');
  
  const messageData = {
    name: username, role: role, pfp: pfp, text: text, time: Date.now(), timeStr: timeStr, style: currentStyle
  };

  if (imgFile) {
    const reader = new FileReader();
    reader.onload = e => { messageData.img = e.target.result; db.ref("messages").push(messageData); };
    reader.readAsDataURL(imgFile);
  } else if (videoFile) {
    const reader = new FileReader();
    reader.onload = e => { messageData.video = e.target.result; db.ref("messages").push(messageData); };
    reader.readAsDataURL(videoFile);
  } else {
    db.ref("messages").push(messageData);
  }

  document.getElementById('text').value = "";
  document.getElementById('imgInput').value = "";
  document.getElementById('videoInput').value = "";
}

// Mesaj render
function renderMessage(m, key) {
  const chat = document.getElementById('chat');
  const div = document.createElement("div");
  div.setAttribute('data-key', key);

  let cls = "msg user";
  if (m.name === username) cls = "msg me";
  if (m.role === "admin") cls = "msg admin";
  if (m.style && m.style !== 'default') cls += ` style-${m.style}`;

  div.className = cls;
  
  const adminCrown = m.role === 'admin' ? '<span class="admin-crown">👑</span>' : '';
  
  // Admin her mesajı silebilir
  const deleteBtn = role === 'admin' ? `<button class="delete-btn" onclick="deleteMessage('${key}')">✕</button>` : '';
  
  div.innerHTML = `
    <div class="msg-header">
      <img src="${m.pfp}" class="msg-pfp" onerror="this.src='https://ui-avatars.com/api/?name=${m.name}&background=2a6eff&color=fff'">
      <span class="msg-username">${m.name} ${adminCrown}</span>
      <span class="msg-time">${m.timeStr}</span>
    </div>
    <div>${m.text || ''}</div>
    ${m.img ? `<img src="${m.img}" loading="lazy">` : ''}
    ${m.video ? `<div class="video-container"><video src="${m.video}" controls preload="metadata"></video></div>` : ''}
    ${deleteBtn}
  `;

  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

// Admin mesaj silme - Her mesajı silebilir
window.deleteMessage = (key) => {
  if (role === 'admin') {
    db.ref(`messages/${key}`).remove();
    showNotification('✅ Mesaj silindi');
  }
}

window.deleteUserMessages = (targetUser) => {
  if (role === 'admin') {
    db.ref('messages').once('value', (snap) => {
      let count = 0;
      snap.forEach(child => {
        if (child.val().name === targetUser) {
          child.ref.remove();
          count++;
        }
      });
      showNotification(`✅ ${targetUser}'ın ${count} mesajı silindi`);
    });
  }
}

// Ban Paneli
window.showBanPanel = (targetUser) => {
  targetBanUser = targetUser;
  document.getElementById('ban-user').textContent = targetUser;
  document.getElementById('ban-panel').style.display = 'block';
}

window.closeBanPanel = () => {
  document.getElementById('ban-panel').style.display = 'none';
  document.getElementById('ban-reason').value = '';
}

window.confirmBan = () => {
  const duration = parseInt(document.getElementById('ban-duration').value);
  const reason = document.getElementById('ban-reason').value.trim() || 'Sebep belirtilmemiş';
  
  const banTime = duration === 0 ? Infinity : Date.now() + duration * 60000;
  
  bannedUsers[targetBanUser] = { until: banTime, reason: reason };
  
  db.ref(`bans/${targetBanUser}`).set({ until: banTime, reason: reason, bannedBy: username, time: Date.now() });
  
  db.ref(`notifications/${targetBanUser}`).push({
    type: 'ban',
    text: `${duration === 0 ? 'Süresiz' : duration + ' dakika'} banlandınız. Sebep: ${reason}`,
    time: Date.now()
  });
  
  showNotification(`🚫 ${targetBanUser} banlandı!`);
  closeBanPanel();
}

// Uyarı Paneli
window.showWarnPanel = (targetUser) => {
  targetWarnUser = targetUser;
  document.getElementById('warn-user').textContent = targetUser;
  document.getElementById('warn-panel').style.display = 'block';
}

window.closeWarnPanel = () => {
  document.getElementById('warn-panel').style.display = 'none';
  document.getElementById('warn-reason').value = '';
}

window.confirmWarn = () => {
  const reason = document.getElementById('warn-reason').value.trim() || 'Kural ihlali';
  
  db.ref(`warnings/${targetWarnUser}`).push({
    reason: reason,
    warnedBy: username,
    time: Date.now(),
    timeStr: new Date().toLocaleString('tr-TR')
  });
  
  db.ref(`notifications/${targetWarnUser}`).push({
    type: 'warn',
    text: `Uyarı aldınız! Sebep: ${reason}`,
    time: Date.now()
  });
  
  showNotification(`⚠️ ${targetWarnUser} uyarıldı!`);
  closeWarnPanel();
}

window.muteUser = (targetUser) => {
  const muteTime = Date.now() + 600000;
  mutedUsers[targetUser] = muteTime;
  
  db.ref(`mutes/${targetUser}`).set({ until: muteTime, mutedBy: username, time: Date.now() });
  
  db.ref(`notifications/${targetUser}`).push({
    type: 'mute',
    text: '10 dakika susturuldunuz!',
    time: Date.now()
  });
  
  showNotification(`🔇 ${targetUser} 10 dakika susturuldu`);
}

// Online panel toggle
window.toggleOnline = () => {
  const panel = document.getElementById('onlinePanel');
  panel.style.display = panel.style.display === "block" ? "none" : "block";
}

// Altun.ai
function loadAltunHistory() {
  const saved = localStorage.getItem("altun_chat_history");
  const messagesDiv = document.getElementById("altun-messages");
  if (saved) {
    messagesDiv.innerHTML = saved;
  } else {
    addAltunMessage("Merhaba! Ben Altun.ai. Size nasıl yardımcı olabilirim?", "altun-bot");
  }
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

function saveAltunChat() {
  localStorage.setItem("altun_chat_history", document.getElementById("altun-messages").innerHTML);
}

function addAltunMessage(text, cls) {
  const div = document.createElement("div");
  div.className = "altun-message " + cls;
  div.textContent = text;
  document.getElementById("altun-messages").appendChild(div);
  document.getElementById("altun-messages").scrollTop = document.getElementById("altun-messages").scrollHeight;
  saveAltunChat();
}

window.sendToAltun = async () => {
  updateActivity();
  const input = document.getElementById("altun-input");
  const text = input.value.trim();
  if (!text) return;

  addAltunMessage("Sen: " + text, "altun-user");
  input.value = "";

  const typingDiv = document.createElement("div");
  typingDiv.className = "altun-message altun-bot";
  typingDiv.innerHTML = `Bot yazıyor <span class="typing"><span class="dot">.</span><span class="dot">.</span><span class="dot">.</span></span>`;
  typingDiv.id = "altun-typing";
  document.getElementById("altun-messages").appendChild(typingDiv);

  try {
    const response = await fetch("https://api.sambanova.ai/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${API_KEY}`
      },
      body: JSON.stringify({
        model: "Meta-Llama-3.1-8B-Instruct",
        messages: [{ role: "user", content: text }]
      })
    });

    const data = await response.json();
    document.getElementById("altun-typing")?.remove();
    const reply = data.choices?.[0]?.message?.content || "Üzgünüm, bir hata oluştu.";
    addAltunMessage("Bot: " + reply, "altun-bot");
  } catch (err) {
    document.getElementById("altun-typing")?.remove();
    addAltunMessage("Bot: Bağlantı hatası oluştu", "altun-bot");
  }
}

// Yılan Oyunu - 360 Derece Joystickli
function initSnake() {
  listenSnakeRooms();
}

function listenSnakeRooms() {
  const serverPath = `snakeRooms_server${currentServers.snake}`;
  db.ref(serverPath).on('value', (snap) => {
    const rooms = snap.val() || {};
    displaySnakeRooms(rooms);
  });
}

function displaySnakeRooms(rooms) {
  const container = document.getElementById('snake-rooms-list');
  container.innerHTML = '';
  
  Object.entries(rooms).forEach(([roomId, room]) => {
    const roomDiv = document.createElement('div');
    roomDiv.className = 'room-item';
    roomDiv.onclick = () => joinSnakeRoom(roomId, room);
    roomDiv.innerHTML = `
      <div class="room-name">${room.name || roomId}</div>
      <div class="room-players">🐍 ${room.player?.name || 'Boş'}</div>
    `;
    container.appendChild(roomDiv);
  });
}

window.createSnakeRoom = () => {
  const roomName = document.getElementById('new-snake-room').value.trim();
  if (!roomName) { showNotification('Oda adı girin!'); return; }
  
  const serverPath = `snakeRooms_server${currentServers.snake}`;
  const roomId = 'snake_' + Date.now();
  db.ref(`${serverPath}/${roomId}`).set({
    name: roomName,
    player: null,
    gameStarted: false,
    gameState: {
      snake: [{x: 10, y: 10}],
      direction: {x: 1, y: 0},
      apple: {x: 15, y: 15},
      score: 0,
      speed: 150
    },
    createdBy: username,
    lastActivity: Date.now()
  });
  document.getElementById('new-snake-room').value = '';
  showNotification('🐍 Oda oluşturuldu!');
}

window.joinSnakeRoom = (roomId, room) => {
  if (room.player) {
    showNotification('Oda dolu!'); return;
  }
  
  gameRooms.snake.current = roomId;
  gameRooms.snake.player = true;
  
  const playerData = { name: username, ready: false, lastActive: Date.now() };
  const serverPath = `snakeRooms_server${currentServers.snake}`;
  db.ref(`${serverPath}/${roomId}/player`).set(playerData);
  
  if (gameRooms.snake.listener) db.ref(`${serverPath}/${roomId}`).off('value', gameRooms.snake.listener);
  
  gameRooms.snake.listener = db.ref(`${serverPath}/${roomId}`).on('value', (snap) => {
    const data = snap.val();
    if (!data) return;
    
    document.getElementById('snake-player1').textContent = data.player?.name || 'Boş';
    const slot = document.getElementById('snake-player1-slot');
    const status = document.getElementById('snake-player1-status');
    
    if (data.player) {
      slot.classList.add('filled');
      if (data.player.ready) {
        slot.classList.add('ready');
        status.textContent = 'Hazır!';
        status.className = 'ready';
      } else {
        slot.classList.remove('ready');
        status.textContent = 'Bekliyor';
        status.className = 'not-ready';
      }
    }
    
    document.getElementById('snake-waiting-title').textContent = data.name;
    
    if (data.player?.ready && !data.gameStarted) {
      startSnakeGame(roomId);
    }
    
    if (data.gameStarted) {
      document.getElementById('snake-waiting').style.display = 'none';
      document.getElementById('snake-canvas').style.display = 'block';
      document.getElementById('snake-joystick').style.display = 'block';
      document.getElementById('snake-hud').style.display = 'flex';
      initSnakeJoystick();
      startSnakeLoop(data.gameState);
    }
  });
}

window.toggleSnakeReady = () => {
  if (!gameRooms.snake.current) return;
  gameRooms.snake.ready = !gameRooms.snake.ready;
  const serverPath = `snakeRooms_server${currentServers.snake}`;
  db.ref(`${serverPath}/${gameRooms.snake.current}/player/ready`).set(gameRooms.snake.ready);
  document.getElementById('snake-ready-btn').classList.toggle('ready', gameRooms.snake.ready);
}

function startSnakeGame(roomId) {
  const serverPath = `snakeRooms_server${currentServers.snake}`;
  db.ref(`${serverPath}/${roomId}`).update({ gameStarted: true });
}

window.leaveSnakeRoom = () => {
  leaveGameRoom('snake');
}

// 360 Derece Joystick
let joystickActive = false;
let joystickAngle = 0;

function initSnakeJoystick() {
  const container = document.getElementById('snake-joystick');
  const stick = document.getElementById('snake-joystick-stick');
  
  const handleStart = (e) => {
    e.preventDefault();
    joystickActive = true;
    updateJoystick(e);
  };
  
  const handleMove = (e) => {
    e.preventDefault();
    if (!joystickActive) return;
    updateJoystick(e);
  };
  
  const handleEnd = () => {
    joystickActive = false;
    stick.style.transform = 'translate(-50%, -50%)';
  };
  
  const updateJoystick = (e) => {
    const rect = container.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;
    
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    
    const dx = clientX - centerX;
    const dy = clientY - centerY;
    const distance = Math.min(Math.sqrt(dx*dx + dy*dy), 40);
    const angle = Math.atan2(dy, dx);
    
    const x = Math.cos(angle) * distance;
    const y = Math.sin(angle) * distance;
    
    stick.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
    
    // Yılan yönünü güncelle
    joystickAngle = angle;
    updateSnakeDirection(angle);
  };
  
  container.addEventListener('touchstart', handleStart, {passive: false});
  container.addEventListener('touchmove', handleMove, {passive: false});
  container.addEventListener('touchend', handleEnd);
  container.addEventListener('mousedown', handleStart);
  document.addEventListener('mousemove', handleMove);
  document.addEventListener('mouseup', handleEnd);
}

function updateSnakeDirection(angle) {
  // Açıyı 8 yöne böl
  const directions = [
    {x: 1, y: 0},   // Sağ
    {x: 1, y: 1},   // Sağ-alt
    {x: 0, y: 1},   // Alt
    {x: -1, y: 1},  // Sol-alt
    {x: -1, y: 0},  // Sol
    {x: -1, y: -1}, // Sol-üst
    {x: 0, y: -1},  // Üst
    {x: 1, y: -1}   // Sağ-üst
  ];
  
  const sector = Math.round((angle + Math.PI) / (Math.PI / 4)) % 8;
  snakeDirection = directions[sector];
}

let snakeDirection = {x: 1, y: 0};
let snakeLoop = null;

function startSnakeLoop(initialState) {
  const canvas = document.getElementById('snake-canvas');
  const ctx = canvas.getContext('2d');
  const gridSize = 20;
  const tileCount = canvas.width / gridSize;
  
  let snake = [...initialState.snake];
  let apple = {...initialState.apple};
  let score = initialState.score;
  let speed = initialState.speed;
  
  if (snakeLoop) clearInterval(snakeLoop);
  
  snakeLoop = setInterval(() => {
    // Yılanı hareket ettir
    const head = {x: snake[0].x + snakeDirection.x, y: snake[0].y + snakeDirection.y};
    
    // Duvar kontrolü - Duvara çarpma yok, karşıdan çık
    if (head.x < 0) head.x = tileCount - 1;
    if (head.x >= tileCount) head.x = 0;
    if (head.y < 0) head.y = tileCount - 1;
    if (head.y >= tileCount) head.y = 0;
    
    // Kendine çarpma kontrolü - ÇARPMA YOK, geçebilir
    // (Yılan kendi üzerinden geçebilir)
    
    snake.unshift(head);
    
    // Elma yeme
    if (head.x === apple.x && head.y === apple.y) {
      score += 10;
      speed = Math.max(50, speed - 2);
      document.getElementById('snake-score').textContent = score;
      
      // Yeni elma
      apple = {
        x: Math.floor(Math.random() * tileCount),
        y: Math.floor(Math.random() * tileCount)
      };
      
      // Firebase güncelle
      const serverPath = `snakeRooms_server${currentServers.snake}`;
      db.ref(`${serverPath}/${gameRooms.snake.current}/gameState`).update({
        snake: snake,
        apple: apple,
        score: score,
        speed: speed
      });
    } else {
      snake.pop();
    }
    
    // Çizim
    ctx.fillStyle = '#0a0a0a';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Izgara
    ctx.strokeStyle = '#1a1a2a';
    ctx.lineWidth = 1;
    for (let i = 0; i < tileCount; i++) {
      ctx.beginPath();
      ctx.moveTo(i * gridSize, 0);
      ctx.lineTo(i * gridSize, canvas.height);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(0, i * gridSize);
      ctx.lineTo(canvas.width, i * gridSize);
      ctx.stroke();
    }
    
    // Elma (🍎)
    ctx.fillStyle = '#ff4444';
    ctx.shadowBlur = 20;
    ctx.shadowColor = '#ff4444';
    ctx.beginPath();
    ctx.arc(
      apple.x * gridSize + gridSize/2,
      apple.y * gridSize + gridSize/2,
      gridSize/2 - 2,
      0,
      Math.PI * 2
    );
    ctx.fill();
    ctx.shadowBlur = 0;
    
    // Yaprak
    ctx.fillStyle = '#4aff4a';
    ctx.beginPath();
    ctx.ellipse(
      apple.x * gridSize + gridSize/2 + 5,
      apple.y * gridSize + 5,
      4,
      8,
      Math.PI / 4,
      0,
      Math.PI * 2
    );
    ctx.fill();
    
    // Yılan
    snake.forEach((segment, index) => {
      const gradient = ctx.createRadialGradient(
        segment.x * gridSize + gridSize/2,
        segment.y * gridSize + gridSize/2,
        0,
        segment.x * gridSize + gridSize/2,
        segment.y * gridSize + gridSize/2,
        gridSize/2
      );
      
      if (index === 0) {
        // Kafa
        gradient.addColorStop(0, '#6aff6a');
        gradient.addColorStop(1, '#4aff4a');
        ctx.shadowBlur = 15;
        ctx.shadowColor = '#4aff4a';
      } else {
        // Vücut
        const alpha = 1 - (index / snake.length) * 0.5;
        gradient.addColorStop(0, `rgba(74, 255, 74, ${alpha})`);
        gradient.addColorStop(1, `rgba(42, 200, 42, ${alpha})`);
        ctx.shadowBlur = 0;
      }
      
      ctx.fillStyle = gradient;
      ctx.beginPath();
      ctx.roundRect(
        segment.x * gridSize + 1,
        segment.y * gridSize + 1,
        gridSize - 2,
        gridSize - 2,
        8
      );
      ctx.fill();
      
      // Gözler (kafa için)
      if (index === 0) {
        ctx.fillStyle = '#000';
        ctx.shadowBlur = 0;
        ctx.beginPath();
        ctx.arc(
          segment.x * gridSize + gridSize/2 - 4,
          segment.y * gridSize + gridSize/2 - 2,
          3,
          0,
          Math.PI * 2
        );
        ctx.arc(
          segment.x * gridSize + gridSize/2 + 4,
          segment.y * gridSize + gridSize/2 - 2,
          3,
          0,
          Math.PI * 2
        );
        ctx.fill();
      }
    });
    
    ctx.shadowBlur = 0;
  }, speed);
}

// Araba Oyunu - 3D Efektli
function initCar() {
  listenCarRooms();
}

function listenCarRooms() {
  const serverPath = `carRooms_server${currentServers.car}`;
  db.ref(serverPath).on('value', (snap) => {
    const rooms = snap.val() || {};
    displayCarRooms(rooms);
  });
}

function displayCarRooms(rooms) {
  const container = document.getElementById('car-rooms-list');
  container.innerHTML = '';
  
  Object.entries(rooms).forEach(([roomId, room]) => {
    const count = (room.player1 ? 1 : 0) + (room.player2 ? 1 : 0);
    const roomDiv = document.createElement('div');
    roomDiv.className = 'room-item';
    roomDiv.onclick = () => joinCarRoom(roomId, room);
    roomDiv.innerHTML = `
      <div class="room-name">${room.name || roomId}</div>
      <div class="room-players">🏎️ ${count}/2 Oyuncu</div>
    `;
    container.appendChild(roomDiv);
  });
}

window.createCarRoom = () => {
  const roomName = document.getElementById('new-car-room').value.trim();
  if (!roomName) { showNotification('Oda adı girin!'); return; }
  
  const serverPath = `carRooms_server${currentServers.car}`;
  const roomId = 'car_' + Date.now();
  db.ref(`${serverPath}/${roomId}`).set({
    name: roomName,
    player1: null,
    player2: null,
    gameStarted: false,
    gameState: {
      cars: [{x: 150, y: 600, speed: 0, lane: 0}, {x: 250, y: 600, speed: 0, lane: 1}],
      obstacles: [],
      scores: [0, 0],
      level: 1,
      speed: 5
    },
    createdBy: username,
    lastActivity: Date.now()
  });
  document.getElementById('new-car-room').value = '';
  showNotification('🏎️ Oda oluşturuldu!');
}

window.joinCarRoom = (roomId, room) => {
  if (room.player1 && room.player2) {
    showNotification('Oda dolu!'); return;
  }
  
  gameRooms.car.current = roomId;
  gameRooms.car.player = !room.player1 ? 1 : 2;
  
  const playerData = { name: username, ready: false, lastActive: Date.now() };
  const serverPath = `carRooms_server${currentServers.car}`;
  const playerKey = gameRooms.car.player === 1 ? 'player1' : 'player2';
  db.ref(`${serverPath}/${roomId}/${playerKey}`).set(playerData);
  
  if (gameRooms.car.listener) db.ref(`${serverPath}/${roomId}`).off('value', gameRooms.car.listener);
  
  gameRooms.car.listener = db.ref(`${serverPath}/${roomId}`).on('value', (snap) => {
    const data = snap.val();
    if (!data) return;
    
    document.getElementById('car-player1').textContent = data.player1?.name || 'Boş';
    document.getElementById('car-player2').textContent = data.player2?.name || 'Boş';
    
    const slot1 = document.getElementById('car-player1-slot');
    const slot2 = document.getElementById('car-player2-slot');
    
    if (data.player1) {
      slot1.classList.add('filled');
      if (data.player1.ready) slot1.classList.add('ready');
    }
    if (data.player2) {
      slot2.classList.add('filled');
      if (data.player2.ready) slot2.classList.add('ready');
    }
    
    document.getElementById('car-waiting-title').textContent = data.name;
    
    if (data.player1?.ready && data.player2?.ready && !data.gameStarted) {
      startCarGame(roomId);
    }
    
    if (data.gameStarted) {
      document.getElementById('car-waiting').style.display = 'none';
      document.getElementById('car-canvas').style.display = 'block';
      document.getElementById('car-joystick').style.display = 'block';
      document.getElementById('car-hud').style.display = 'flex';
      initCarJoystick();
      startCarLoop(data.gameState);
    }
  });
}

window.toggleCarReady = () => {
  if (!gameRooms.car.current) return;
  gameRooms.car.ready = !gameRooms.car.ready;
  const serverPath = `carRooms_server${currentServers.car}`;
  const playerKey = gameRooms.car.player === 1 ? 'player1' : 'player2';
  db.ref(`${serverPath}/${gameRooms.car.current}/${playerKey}/ready`).set(gameRooms.car.ready);
  document.getElementById('car-ready-btn').classList.toggle('ready', gameRooms.car.ready);
}

function startCarGame(roomId) {
  const serverPath = `carRooms_server${currentServers.car}`;
  db.ref(`${serverPath}/${roomId}`).update({ gameStarted: true });
}

window.leaveCarRoom = () => {
  leaveGameRoom('car');
}

let carSteering = 0;

function initCarJoystick() {
  const container = document.getElementById('car-joystick');
  const stick = document.getElementById('car-joystick-stick');
  
  const handleStart = (e) => {
    e.preventDefault();
    joystickActive = true;
    updateCarJoystick(e);
  };
  
  const handleMove = (e) => {
    e.preventDefault();
    if (!joystickActive) return;
    updateCarJoystick(e);
  };
  
  const handleEnd = () => {
    joystickActive = false;
    carSteering = 0;
    stick.style.transform = 'translate(-50%, -50%)';
  };
  
  const updateCarJoystick = (e) => {
    const rect = container.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const dx = Math.max(-50, Math.min(50, clientX - centerX));
    
    const x = dx;
    stick.style.transform = `translate(calc(-50% + ${x}px), -50%)`;
    
    carSteering = dx / 50; // -1 ile 1 arası
  };
  
  container.addEventListener('touchstart', handleStart, {passive: false});
  container.addEventListener('touchmove', handleMove, {passive: false});
  container.addEventListener('touchend', handleEnd);
  container.addEventListener('mousedown', handleStart);
  document.addEventListener('mousemove', handleMove);
  document.addEventListener('mouseup', handleEnd);
}

let carLoop = null;

function startCarLoop(initialState) {
  const canvas = document.getElementById('car-canvas');
  const ctx = canvas.getContext('2d');
  
  let cars = initialState.cars.map(c => ({...c}));
  let obstacles = initialState.obstacles.map(o => ({...o}));
  let score = initialState.scores[gameRooms.car.player - 1];
  let level = initialState.level;
  let gameSpeed = initialState.speed;
  let myCar = cars[gameRooms.car.player - 1];
  
  if (carLoop) cancelAnimationFrame(carLoop);
  
  let lastTime = 0;
  let obstacleTimer = 0;
  
  function gameLoop(timestamp) {
    const deltaTime = timestamp - lastTime;
    lastTime = timestamp;
    
    // Arabayı kontrol et
    myCar.x += carSteering * 8;
    myCar.x = Math.max(30, Math.min(canvas.width - 30, myCar.x));
    
    // Otomatik ilerleme
    gameSpeed = Math.min(15, 5 + score / 100);
    myCar.speed = gameSpeed * 20;
    
    // Engelleri güncelle
    obstacleTimer += deltaTime;
    if (obstacleTimer > 2000 - level * 200) {
      obstacleTimer = 0;
      const lane = Math.floor(Math.random() * 4);
      const x = 50 + lane * 100;
      obstacles.push({
        x: x,
        y: -100,
        width: 60,
        height: 100,
        type: Math.random() > 0.5 ? 'car' : 'truck',
        color: `hsl(${Math.random() * 360}, 70%, 50%)`
      });
    }
    
    obstacles.forEach(obs => {
      obs.y += gameSpeed * 2;
    });
    
    obstacles = obstacles.filter(obs => obs.y < canvas.height + 100);
    
    // Çarpışma kontrolü
    obstacles.forEach(obs => {
      if (myCar.x - 25 < obs.x + obs.width/2 &&
          myCar.x + 25 > obs.x - obs.width/2 &&
          myCar.y - 40 < obs.y + obs.height/2 &&
          myCar.y + 40 > obs.y - obs.height/2) {
        // Çarpışma - Oyun bitti
        showNotification('💥 Çarptın! Oyun bitti!');
        obstacles = [];
        score = Math.max(0, score - 50);
      }
    });
    
    // Skor
    score += Math.floor(gameSpeed / 5);
    document.getElementById('car-score').textContent = score;
    document.getElementById('car-speed').textContent = Math.floor(myCar.speed);
    
    // Seviye atlama
    if (score > level * 500) {
      level++;
      showNotification(`🎉 Seviye ${level}!`);
    }
    
    // Çizim - 3D Efektli
    ctx.fillStyle = '#1a1a2a';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Yol - 3D perspektif
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, '#2a3a4a');
    gradient.addColorStop(1, '#0a1a2a');
    ctx.fillStyle = gradient;
    ctx.fillRect(20, 0, canvas.width - 40, canvas.height);
    
    // Şerit çizgileri - Hareketli
    ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
    ctx.lineWidth = 4;
    ctx.setLineDash([40, 40]);
    ctx.lineDashOffset = -Date.now() / 10 * gameSpeed;
    
    for (let i = 1; i < 4; i++) {
      ctx.beginPath();
      ctx.moveTo(i * 100, 0);
      ctx.lineTo(i * 100, canvas.height);
      ctx.stroke();
    }
    
    ctx.setLineDash([]);
    
    // Engeller - 3D Arabalar
    obstacles.forEach(obs => {
      // Gölge
      ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
      ctx.beginPath();
      ctx.ellipse(obs.x, obs.y + obs.height/2 + 10, obs.width/2, 10, 0, 0, Math.PI * 2);
      ctx.fill();
      
      // Araba gövdesi - 3D efekt
      const carGradient = ctx.createLinearGradient(obs.x - obs.width/2, obs.y - obs.height/2, obs.x + obs.width/2, obs.y + obs.height/2);
      carGradient.addColorStop(0, obs.color);
      carGradient.addColorStop(0.5, lightenColor(obs.color, 20));
      carGradient.addColorStop(1, darkenColor(obs.color, 20));
      
      ctx.fillStyle = carGradient;
      ctx.beginPath();
      ctx.roundRect(obs.x - obs.width/2, obs.y - obs.height/2, obs.width, obs.height, 15);
      ctx.fill();
      
      // Cam
      ctx.fillStyle = '#4a9eff';
      ctx.beginPath();
      ctx.roundRect(obs.x - obs.width/3, obs.y - obs.height/3, obs.width/1.5, obs.height/3, 8);
      ctx.fill();
      
      // Farlar
      ctx.fillStyle = '#ffffaa';
      ctx.shadowBlur = 20;
      ctx.shadowColor = '#ffffaa';
      ctx.beginPath();
      ctx.arc(obs.x - obs.width/3, obs.y + obs.height/2 - 10, 6, 0, Math.PI * 2);
      ctx.arc(obs.x + obs.width/3, obs.y + obs.height/2 - 10, 6, 0, Math.PI * 2);
      ctx.fill();
      ctx.shadowBlur = 0;
    });
    
    // Benim arabam - 3D
    const myCarGradient = ctx.createLinearGradient(myCar.x - 25, myCar.y - 40, myCar.x + 25, myCar.y + 40);
    myCarGradient.addColorStop(0, '#2a6eff');
    myCarGradient.addColorStop(0.5, '#4a9eff');
    myCarGradient.addColorStop(1, '#1a5eef');
    
    // Gölge
    ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
    ctx.beginPath();
    ctx.ellipse(myCar.x, myCar.y + 50, 30, 12, 0, 0, Math.PI * 2);
    ctx.fill();
    
    // Araba
    ctx.fillStyle = myCarGradient;
    ctx.beginPath();
    ctx.roundRect(myCar.x - 25, myCar.y - 40, 50, 80, 20);
    ctx.fill();
    
    // Cam
    ctx.fillStyle = '#6a9aff';
    ctx.beginPath();
    ctx.roundRect(myCar.x - 18, myCar.y - 25, 36, 30, 10);
    ctx.fill();
    
    // Farlar - Parlak
    ctx.fillStyle = '#ffffff';
    ctx.shadowBlur = 30;
    ctx.shadowColor = '#ffffff';
    ctx.beginPath();
    ctx.arc(myCar.x - 15, myCar.y - 35, 8, 0, Math.PI * 2);
    ctx.arc(myCar.x + 15, myCar.y - 35, 8, 0, Math.PI * 2);
    ctx.fill();
    ctx.shadowBlur = 0;
    
    // Stop lambaları
    ctx.fillStyle = '#ff4444';
    ctx.shadowBlur = 15;
    ctx.shadowColor = '#ff4444';
    ctx.beginPath();
    ctx.arc(myCar.x - 15, myCar.y + 35, 6, 0, Math.PI * 2);
    ctx.arc(myCar.x + 15, myCar.y + 35, 6, 0, Math.PI * 2);
    ctx.fill();
    ctx.shadowBlur = 0;
    
    // Hız efekti - Motion blur
    if (gameSpeed > 10) {
      ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
      ctx.lineWidth = 2;
      for (let i = 0; i < 5; i++) {
        const y = Math.random() * canvas.height;
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
      }
    }
    
    // Firebase güncelle
    if (Math.random() < 0.1) {
      const serverPath = `carRooms_server${currentServers.car}`;
      db.ref(`${serverPath}/${gameRooms.car.current}/gameState`).update({
        cars: cars,
        obstacles: obstacles,
        scores: gameRooms.car.player === 1 ? [score, 0] : [0, score],
        level: level,
        speed: gameSpeed
      });
    }
    
    carLoop = requestAnimationFrame(gameLoop);
  }
  
  carLoop = requestAnimationFrame(gameLoop);
}

// Yardımcı renk fonksiyonları
function lightenColor(color, percent) {
  const num = parseInt(color.replace("#",""), 16),
  amt = Math.round(2.55 * percent),
  R = (num >> 16) + amt,
  B = (num >> 8 & 0x00FF) + amt,
  G = (num & 0x0000FF) + amt;
  return "#" + (0x1000000 + (R<255?R<1?0:R:255)*0x10000 + (B<255?B<1?0:B:255)*0x100 + (G<255?G<1?0:G:255)).toString(16).slice(1);
}

function darkenColor(color, percent) {
  const num = parseInt(color.replace("#",""), 16),
  amt = Math.round(2.55 * percent),
  R = (num >> 16) - amt,
  B = (num >> 8 & 0x00FF) - amt,
  G = (num & 0x0000FF) - amt;
  return "#" + (0x1000000 + (R>0?R:0)*0x10000 + (B>0?B:0)*0x100 + (G>0?G:0)).toString(16).slice(1);
}

// XOX Oyunu
function initTictactoe() {
  listenTictactoeRooms();
}

function listenTictactoeRooms() {
  const serverPath = `tictactoeRooms_server${currentServers.tictactoe}`;
  db.ref(serverPath).on('value', (snap) => {
    const rooms = snap.val() || {};
    displayTictactoeRooms(rooms);
  });
}

function displayTictactoeRooms(rooms) {
  const container = document.getElementById('tictactoe-rooms-list');
  container.innerHTML = '';
  
  Object.entries(rooms).forEach(([roomId, room]) => {
    const count = (room.x ? 1 : 0) + (room.o ? 1 : 0);
    const roomDiv = document.createElement('div');
    roomDiv.className = 'room-item';
    roomDiv.onclick = () => joinTictactoeRoom(roomId, room);
    roomDiv.innerHTML = `
      <div class="room-name">${room.name || roomId}</div>
      <div class="room-players">⭕❌ ${count}/2 Oyuncu</div>
    `;
    container.appendChild(roomDiv);
  });
}

window.createTictactoeRoom = () => {
  const roomName = document.getElementById('new-tictactoe-room').value.trim();
  if (!roomName) { showNotification('Oda adı girin!'); return; }
  
  const serverPath = `tictactoeRooms_server${currentServers.tictactoe}`;
  const roomId = 'ttt_' + Date.now();
  db.ref(`${serverPath}/${roomId}`).set({
    name: roomName,
    x: null,
    o: null,
    gameStarted: false,
    board: ['', '', '', '', '', '', '', '', ''],
    currentTurn: 'x',
    winner: null,
    createdBy: username,
    lastActivity: Date.now()
  });
  document.getElementById('new-tictactoe-room').value = '';
  showNotification('⭕❌ Oda oluşturuldu!');
}

window.joinTictactoeRoom = (roomId, room) => {
  if (room.x && room.o) {
    showNotification('Oda dolu!'); return;
  }
  
  gameRooms.tictactoe.current = roomId;
  gameRooms.tictactoe.player = !room.x ? 'x' : 'o';
  
  const playerData = { name: username, ready: false, lastActive: Date.now() };
  const serverPath = `tictactoeRooms_server${currentServers.tictactoe}`;
  const playerKey = gameRooms.tictactoe.player;
  db.ref(`${serverPath}/${roomId}/${playerKey}`).set(playerData);
  
  if (gameRooms.tictactoe.listener) db.ref(`${serverPath}/${roomId}`).off('value', gameRooms.tictactoe.listener);
  
  gameRooms.tictactoe.listener = db.ref(`${serverPath}/${roomId}`).on('value', (snap) => {
    const data = snap.val();
    if (!data) return;
    
    document.getElementById('tictactoe-x').textContent = data.x?.name || 'Boş';
    document.getElementById('tictactoe-o').textContent = data.o?.name || 'Boş';
    
    const xSlot = document.getElementById('tictactoe-x-slot');
    const oSlot = document.getElementById('tictactoe-o-slot');
    
    if (data.x) {
      xSlot.classList.add('filled');
      if (data.x.ready) xSlot.classList.add('ready');
    }
    if (data.o) {
      oSlot.classList.add('filled');
      if (data.o.ready) oSlot.classList.add('ready');
    }
    
    document.getElementById('tictactoe-waiting-title').textContent = data.name;
    
    if (data.x?.ready && data.o?.ready && !data.gameStarted) {
      startTictactoeGame(roomId);
    }
    
    if (data.gameStarted) {
      document.getElementById('tictactoe-waiting').style.display = 'none';
      document.getElementById('tictactoe-board').style.display = 'grid';
      document.getElementById('tictactoe-status').style.display = 'block';
      document.getElementById('tictactoe-reset').style.display = 'block';
      updateTictactoeBoard(data);
    }
  });
}

window.toggleTictactoeReady = () => {
  if (!gameRooms.tictactoe.current) return;
  gameRooms.tictactoe.ready = !gameRooms.tictactoe.ready;
  const serverPath = `tictactoeRooms_server${currentServers.tictactoe}`;
  const playerKey = gameRooms.tictactoe.player;
  db.ref(`${serverPath}/${gameRooms.tictactoe.current}/${playerKey}/ready`).set(gameRooms.tictactoe.ready);
  document.getElementById('tictactoe-ready-btn').classList.toggle('ready', gameRooms.tictactoe.ready);
}

function startTictactoeGame(roomId) {
  const serverPath = `tictactoeRooms_server${currentServers.tictactoe}`;
  db.ref(`${serverPath}/${roomId}`).update({ gameStarted: true });
}

window.leaveTictactoeRoom = () => {
  leaveGameRoom('tictactoe');
}

function updateTictactoeBoard(data) {
  const cells = document.querySelectorAll('.tictactoe-cell');
  data.board.forEach((value, index) => {
    cells[index].textContent = value === 'x' ? '⭕' : value === 'o' ? '❌' : '';
    cells[index].className = 'tictactoe-cell' + (value ? ' taken ' + value : '');
  });
  
  const status = document.getElementById('tictactoe-status');
  if (data.winner) {
    if (data.winner === 'draw') {
      status.textContent = '🤝 Berabere!';
      status.style.color = '#ffaa2a';
    } else {
      status.textContent = `🎉 Kazanan: ${data.winner === 'x' ? '⭕' : '❌'}`;
      status.style.color = data.winner === gameRooms.tictactoe.player ? '#4aff4a' : '#ff5a5a';
    }
  } else {
    const isMyTurn = data.currentTurn === gameRooms.tictactoe.player;
    status.textContent = isMyTurn ? '🎯 Sıra sende!' : '⏳ Rakibin sırası...';
    status.style.color = isMyTurn ? '#4aff4a' : '#8892a6';
  }
}

window.makeTictactoeMove = (index) => {
  if (!gameRooms.tictactoe.current) return;
  
  const serverPath = `tictactoeRooms_server${currentServers.tictactoe}`;
  db.ref(`${serverPath}/${gameRooms.tictactoe.current}`).once('value', (snap) => {
    const data = snap.val();
    if (!data || data.board[index] || data.winner || data.currentTurn !== gameRooms.tictactoe.player) return;
    
    const newBoard = [...data.board];
    newBoard[index] = gameRooms.tictactoe.player;
    
    const winner = checkTictactoeWinner(newBoard);
    
    db.ref(`${serverPath}/${gameRooms.tictactoe.current}`).update({
      board: newBoard,
      currentTurn: gameRooms.tictactoe.player === 'x' ? 'o' : 'x',
      winner: winner
    });
  });
}

function checkTictactoeWinner(board) {
  const lines = [
    [0, 1, 2], [3, 4, 5], [6, 7, 8],
    [0, 3, 6], [1, 4, 7], [2, 5, 8],
    [0, 4, 8], [2, 4, 6]
  ];
  
  for (let line of lines) {
    const [a, b, c] = line;
    if (board[a] && board[a] === board[b] && board[a] === board[c]) {
      return board[a];
    }
  }
  
  if (board.every(cell => cell !== '')) return 'draw';
  return null;
}

window.resetTictactoe = () => {
  if (!gameRooms.tictactoe.current) return;
  const serverPath = `tictactoeRooms_server${currentServers.tictactoe}`;
  db.ref(`${serverPath}/${gameRooms.tictactoe.current}`).update({
    board: ['', '', '', '', '', '', '', '', ''],
    currentTurn: 'x',
    winner: null
  });
}

// Oda'dan çıkma - Genel fonksiyon
function leaveGameRoom(game) {
  const room = gameRooms[game];
  if (!room.current) return;
  
  const serverPath = `${game}Rooms_server${currentServers[game]}`;
  
  if (game === 'snake') {
    db.ref(`${serverPath}/${room.current}/player`).remove();
    if (snakeLoop) clearInterval(snakeLoop);
    document.getElementById('snake-waiting').style.display = 'flex';
    document.getElementById('snake-canvas').style.display = 'none';
    document.getElementById('snake-joystick').style.display = 'none';
    document.getElementById('snake-hud').style.display = 'none';
  } else if (game === 'car') {
    const playerKey = room.player === 1 ? 'player1' : 'player2';
    db.ref(`${serverPath}/${room.current}/${playerKey}`).remove();
    if (carLoop) cancelAnimationFrame(carLoop);
    document.getElementById('car-waiting').style.display = 'flex';
    document.getElementById('car-canvas').style.display = 'none';
    document.getElementById('car-joystick').style.display = 'none';
    document.getElementById('car-hud').style.display = 'none';
  } else if (game === 'tictactoe') {
    db.ref(`${serverPath}/${room.current}/${room.player}`).remove();
    document.getElementById('tictactoe-waiting').style.display = 'flex';
    document.getElementById('tictactoe-board').style.display = 'none';
    document.getElementById('tictactoe-status').style.display = 'none';
    document.getElementById('tictactoe-reset').style.display = 'none';
  }
  
  if (room.listener) db.ref(`${serverPath}/${room.current}`).off('value', room.listener);
  
  room.current = null;
  room.player = null;
  room.ready = false;
  room.listener = null;
}

// Sayı Tahmin
function initGuessGame() {
  updateScoreboard();
  db.ref('guessScores').on('value', (snap) => {
    guessPlayers = snap.val() || {};
    updateScoreboard();
  });
  if (username) {
    db.ref(`guessScores/${username}`).set({ 
      name: username, 
      role: role, 
      score: guessScore, 
      lastActive: Date.now() 
    });
  }
}

function updateScoreboard() {
  const scoreList = document.getElementById('score-list');
  scoreList.innerHTML = '';
  
  const sorted = Object.entries(guessPlayers)
    .filter(([_, d]) => d.score > 0)
    .sort((a, b) => b[1].score - a[1].score)
    .slice(0, 10);
  
  sorted.forEach(([id, data], index) => {
    const div = document.createElement('div');
    div.className = `score-item ${id === username ? 'me' : ''}`;
    div.innerHTML = `
      <span class="rank">#${index+1}</span>
      <span class="name">${data.name || id} ${data.role === 'admin' ? '👑' : ''}</span>
      <span class="score">${data.score}</span>
    `;
    scoreList.appendChild(div);
  });
}

window.makeGuess = () => {
  if (!guessGameActive) { 
    showNotification('Önce yeni oyun başlat!'); 
    return; 
  }
  
  const input = document.getElementById('guess-input');
  const guess = parseInt(input.value);
  if (isNaN(guess) || guess < 1 || guess > 100) { 
    showNotification('1-100 arası sayı gir!'); 
    return; 
  }
  
  guessAttempts++;
  const historyList = document.getElementById('history-list');
  const item = document.createElement('div');
  
  if (guess === guessTarget) {
    guessGameActive = false;
    document.getElementById('target-number').textContent = guessTarget;
    document.getElementById('guess-submit').disabled = true;
    item.className = 'history-item correct'; 
    item.textContent = guess + ' ✓';
    
    const points = Math.max(10, 100 - (guessAttempts * 10));
    guessScore += points; 
    userPoints += points;
    
    db.ref(`guessScores/${username}`).update({ score: guessScore });
    db.ref(`users/${username}/points`).set(userPoints);
    document.getElementById('user-points').textContent = userPoints;
    
    showNotification(`🎉 Kazandın! +${points} puan`);
    
    const feedback = document.getElementById('guess-feedback');
    feedback.textContent = '🎉';
    feedback.className = 'correct';
    setTimeout(() => { feedback.textContent = ''; }, 1000);
    
  } else if (guess < guessTarget) {
    if (guess > guessMin) guessMin = guess + 1;
    item.className = 'history-item low'; 
    item.textContent = guess + ' ↑';
    
    const feedback = document.getElementById('guess-feedback');
    feedback.textContent = '📈';
    feedback.className = 'low';
    setTimeout(() => { feedback.textContent = ''; }, 800);
    
  } else {
    if (guess < guessMax) guessMax = guess - 1;
    item.className = 'history-item high'; 
    item.textContent = guess + ' ↓';
    
    const feedback = document.getElementById('guess-feedback');
    feedback.textContent = '📉';
    feedback.className = 'high';
    setTimeout(() => { feedback.textContent = ''; }, 800);
  }
  
  historyList.appendChild(item);
  historyList.scrollTop = historyList.scrollHeight;
  
  document.getElementById('min-range').textContent = guessMin;
  document.getElementById('max-range').textContent = guessMax;
  input.value = '';
  input.focus();
}

window.startNewGuessGame = () => {
  guessTarget = Math.floor(Math.random() * 100) + 1;
  guessMin = 1; guessMax = 100; guessAttempts = 0; guessGameActive = true;
  document.getElementById('target-number').textContent = '?';
  document.getElementById('min-range').textContent = '1';
  document.getElementById('max-range').textContent = '100';
  document.getElementById('history-list').innerHTML = '';
  document.getElementById('guess-submit').disabled = false;
  document.getElementById('guess-input').focus();
  showNotification('🔄 Yeni sayı belirlendi!');
}

// Kullanıcı verileri
function loadUserData() {
  db.ref(`users/${username}/points`).on('value', (snap) => {
    userPoints = snap.val() || 0;
    document.getElementById('user-points').textContent = userPoints;
  });
  
  db.ref(`users/${username}/styles`).on('value', (snap) => {
    purchasedStyles = snap.val() || ['default'];
  });
  
  db.ref(`users/${username}/activeStyle`).on('value', (snap) => {
    currentStyle = snap.val() || 'default';
  });
  
  db.ref(`users/${username}/themes`).on('value', (snap) => {
    purchasedThemes = snap.val() || ['default'];
  });
  
  db.ref(`users/${username}/activeTheme`).on('value', (snap) => {
    currentTheme = snap.val() || 'default';
    applyTheme(currentTheme);
  });
}

function applyTheme(themeId) {
  const theme = THEME_DEFINITIONS[themeId];
  if (!theme) return;
  
  if (themeId === 'default') {
    document.body.style.background = '';
  } else {
    document.body.style.background = theme.bg;
  }
}

// Mağaza
let currentShopTab = 'bubbles';

window.switchShopTab = (tab) => {
  currentShopTab = tab;
  document.querySelectorAll('.shop-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.shop-section').forEach(s => s.classList.remove('active'));
  
  event.target.classList.add('active');
  document.getElementById('shop-' + tab).classList.add('active');
  
  if (tab === 'bubbles') renderBubbleShop();
  else renderThemeShop();
}

window.openShop = () => {
  renderBubbleShop();
  renderThemeShop();
  document.getElementById('shop-panel').style.display = 'flex';
  closeMenu();
}

function renderBubbleShop() {
  const container = document.getElementById('shop-bubbles');
  container.innerHTML = '';
  
  Object.entries(STYLE_DEFINITIONS).forEach(([styleId, style]) => {
    if (styleId === 'default') return;
    
    const owned = purchasedStyles.includes(styleId);
    const div = document.createElement('div');
    div.className = `shop-item ${owned ? 'disabled' : ''}`;
    div.innerHTML = `
      <div class="shop-item-preview" style="background: ${style.color}; border: ${styleId === 'blackwhite' ? '3px solid #fff' : 'none'};">
        ${style.emoji}
      </div>
      <div class="shop-item-info">
        <h3>${style.name}</h3>
        <p>${styleId === 'blackwhite' ? 'Premium Siyah Beyaz Tasarım' : 'Özel sohbet baloncuğu stili'}</p>
      </div>
      <div class="shop-item-price">
        ${owned ? '✓ SAHİP' : `${style.price}💰`}
      </div>
    `;
    if (!owned) div.onclick = () => buyItem('style', styleId, style.price);
    container.appendChild(div);
  });
}

function renderThemeShop() {
  const container = document.getElementById('shop-themes');
  container.innerHTML = '';
  
  Object.entries(THEME_DEFINITIONS).forEach(([themeId, theme]) => {
    if (themeId === 'default') return;
    
    const owned = purchasedThemes.includes(themeId);
    const div = document.createElement('div');
    div.className = `shop-item ${owned ? 'disabled' : ''}`;
    div.innerHTML = `
      <div class="shop-item-preview" style="background: ${theme.bg}; border: 2px solid #4a9eff;">
        ${theme.emoji}
      </div>
      <div class="shop-item-info">
        <h3>${theme.name}</h3>
        <p>Uygulama teması</p>
      </div>
      <div class="shop-item-price">
        ${owned ? '✓ SAHİP' : `${theme.price}💰`}
      </div>
    `;
    if (!owned) div.onclick = () => buyItem('theme', themeId, theme.price);
    container.appendChild(div);
  });
}

window.buyItem = (type, id, price) => {
  if (userPoints < price) { showNotification('Yetersiz puan!'); return; }
  
  userPoints -= price;
  db.ref(`users/${username}/points`).set(userPoints);
  
  if (type === 'style') {
    purchasedStyles.push(id);
    currentStyle = id;
    db.ref(`users/${username}/styles`).set(purchasedStyles);
    db.ref(`users/${username}/activeStyle`).set(id);
    renderBubbleShop();
  } else {
    purchasedThemes.push(id);
    currentTheme = id;
    db.ref(`users/${username}/themes`).set(purchasedThemes);
    db.ref(`users/${username}/activeTheme`).set(id);
    applyTheme(id);
    renderThemeShop();
  }
  
  showNotification('✨ Satın alındı!');
}

window.scrollShop = (direction) => {
  const section = document.getElementById('shop-' + currentShopTab);
  section.scrollBy({ top: direction * 200, behavior: 'smooth' });
}

window.closeShop = () => {
  document.getElementById('shop-panel').style.display = 'none';
}

// Envanter
window.openInventory = () => {
  const grid = document.getElementById('inventory-grid');
  grid.innerHTML = '';
  
  // Stiller
  purchasedStyles.forEach(styleId => {
    const style = STYLE_DEFINITIONS[styleId];
    const div = document.createElement('div');
    div.className = `inventory-item ${currentStyle === styleId ? 'active' : ''}`;
    div.innerHTML = `
      <div class="inventory-item-preview" style="background: ${style.color}; border: ${styleId === 'blackwhite' ? '2px solid #fff' : 'none'};">
        ${style.emoji}
      </div>
      <div class="inventory-item-name">${style.name}</div>
      ${currentStyle === styleId ? '<div class="inventory-item-badge">✓</div>' : ''}
    `;
    div.onclick = () => equipItem('style', styleId);
    grid.appendChild(div);
  });
  
  // Temalar
  purchasedThemes.forEach(themeId => {
    const theme = THEME_DEFINITIONS[themeId];
    const div = document.createElement('div');
    div.className = `inventory-item ${currentTheme === themeId ? 'active' : ''}`;
    div.innerHTML = `
      <div class="inventory-item-preview" style="background: ${theme.bg}; border: 2px solid #4a9eff;">
        ${theme.emoji}
      </div>
      <div class="inventory-item-name">${theme.name}</div>
      ${currentTheme === themeId ? '<div class="inventory-item-badge">✓</div>' : ''}
    `;
    div.onclick = () => equipItem('theme', themeId);
    grid.appendChild(div);
  });
  
  document.getElementById('inventory-panel').style.display = 'flex';
  closeMenu();
}

window.equipItem = (type, id) => {
  if (type === 'style') {
    currentStyle = id;
    db.ref(`users/${username}/activeStyle`).set(id);
  } else {
    currentTheme = id;
    db.ref(`users/${username}/activeTheme`).set(id);
    applyTheme(id);
  }
  showNotification(`✨ ${type === 'style' ? STYLE_DEFINITIONS[id].name : THEME_DEFINITIONS[id].name} kuşanıldı!`);
  openInventory();
}

window.scrollInventory = (direction) => {
  const grid = document.getElementById('inventory-grid');
  grid.scrollBy({ top: direction * 150, behavior: 'smooth' });
}

window.closeInventory = () => {
  document.getElementById('inventory-panel').style.display = 'none';
}

// Geri Bildirim
window.openFeedback = () => {
  document.getElementById('feedback-panel').style.display = 'block';
  if (role === 'admin') loadFeedbackHistory();
  closeMenu();
}

window.closeFeedback = () => {
  document.getElementById('feedback-panel').style.display = 'none';
  document.getElementById('feedback-text').value = '';
}

window.setFeedbackType = (type) => {
  currentFeedbackType = type;
  document.querySelectorAll('.feedback-type-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
}

window.submitFeedback = () => {
  const text = document.getElementById('feedback-text').value.trim();
  if (!text) { showNotification('Mesaj yaz!'); return; }
  
  db.ref('feedback').push({
    user: username, 
    type: currentFeedbackType, 
    text: text,
    time: Date.now(), 
    timeStr: new Date().toLocaleString('tr-TR')
  });
  
  document.getElementById('feedback-text').value = '';
  showNotification('Teşekkürler! Geri bildirimin alındı.');
  if (role === 'admin') loadFeedbackHistory();
}

function loadFeedbackHistory() {
  const listDiv = document.getElementById('feedback-list');
  listDiv.style.display = 'block';
  
  db.ref('feedback').orderByChild('time').limitToLast(10).on('value', (snap) => {
    listDiv.innerHTML = '';
    const feedbacks = snap.val() || {};
    Object.values(feedbacks).reverse().forEach(f => {
      const div = document.createElement('div');
      div.className = 'feedback-item';
      div.innerHTML = `
        <div class="feedback-header">
          <span>${f.user}</span>
          <span class="feedback-type-badge">${f.type}</span>
        </div>
        <div>${f.text}</div>
        <div style="font-size: 11px; color: #8892a6; margin-top: 6px;">${f.timeStr}</div>
      `;
      listDiv.appendChild(div);
    });
  });
}

// Bildirim
function showNotification(text) {
  const notif = document.createElement('div');
  notif.className = 'notification';
  notif.textContent = text;
  document.body.appendChild(notif);
  setTimeout(() => notif.remove(), 3000);
}

// Sayfa yüklendiğinde
window.onload = () => {
  switchScreen('chat');
  
  // Input olayları
  document.getElementById('guess-input').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') makeGuess();
  });
  
  document.getElementById('altun-input').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') sendToAltun();
  });
  
  // Sayfa kapanışı
  window.addEventListener('beforeunload', () => {
    if (username) {
      db.ref(`typing/${username}`).remove();
      if (onlineRef) onlineRef.remove();
      Object.keys(gameRooms).forEach(game => {
        if (gameRooms[game].current) leaveGameRoom(game);
      });
    }
  });
  
  // PWA desteği
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('data:text/javascript,').catch(() => {});
  }
}
</script>

</body>
</html>
