<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>7/D Sohbet</title>

<style>
body{
 margin:0;
 font-family:Arial, sans-serif;
 color:white;
 overflow:hidden;
 background:black;
}

/* RGB BACKGROUND */
body::before{
 content:"";
 position:fixed;
 inset:0;
 background:linear-gradient(45deg, red, blue, lime, red);
 background-size:400% 400%;
 animation:rgb 12s linear infinite;
 opacity:.25;
 z-index:-1;
}
@keyframes rgb{
 0%{background-position:0% 50%}
 50%{background-position:100% 50%}
 100%{background-position:0% 50%}
}

/* TOPBAR */
#topbar{
 height:55px;
 background:#020617;
 display:flex;
 align-items:center;
 padding:0 15px;
}

#menuBtn{ font-size:26px; cursor:pointer; }

/* SIDEBAR */
#sidebar{
 position:fixed;
 left:-260px;
 top:0;
 width:260px;
 height:100%;
 background:#020617;
 padding:70px 10px;
 transition:.25s;
 visibility:hidden;
 z-index:5;
}
#sidebar.open{
 left:0;
 visibility:visible;
}

.channel{
 background:#1e293b;
 padding:12px;
 border-radius:12px;
 margin-bottom:10px;
 cursor:pointer;
}

/* CHAT */
#chat{
 position:absolute;
 top:55px;
 bottom:70px;
 left:0;
 right:0;
 overflow-y:auto;
 padding:10px;
 display:flex;
 flex-direction:column;
 gap:8px;
}

.msg{
 max-width:70%;
 padding:10px 14px;
 border-radius:16px;
 font-size:14px;
 line-height:1.4;
 word-wrap:break-word;
 animation:fade .12s ease-out;
}
.left{ background:#1e293b; align-self:flex-start; }
.right{ background:#2563eb; align-self:flex-end; }

@keyframes fade{
 from{opacity:.4;transform:translateY(3px)}
 to{opacity:1;transform:none}
}

/* INPUT BAR */
#inputBar{
 position:fixed;
 bottom:0;
 left:0;
 right:0;
 height:70px;
 background:#020617;
 display:flex;
 align-items:center;
 gap:6px;
 padding:8px;
 box-sizing:border-box;
}

#text{
 flex:1;
 height:40px;
 border:none;
 border-radius:10px;
 padding:0 10px;
 font-size:16px;
}

button{
 height:40px;
 padding:0 14px;
 border-radius:10px;
 border:none;
 background:#1e293b;
 color:white;
 cursor:pointer;
}

#fileInput{ display:none; }

/* LOGIN */
#login{
 position:fixed;
 inset:0;
 background:#020617;
 display:flex;
 justify-content:center;
 align-items:center;
 flex-direction:column;
 gap:10px;
 z-index:10;
}
#login input{
 width:220px;
 height:40px;
 border-radius:10px;
 border:none;
 padding:0 10px;
}

#avatar{
 width:70px;
 height:70px;
 border-radius:50%;
 object-fit:cover;
 background:#1e293b;
}
</style>
</head>

<body>

<div id="login">
 <img id="avatar">
 <input type="file" id="avatarInput" accept="image/*">
 <input id="nameInput" placeholder="KullanÄ±cÄ± adÄ±">
 <input id="codeInput" placeholder="Kod">
 <button onclick="enter()">GiriÅŸ</button>
</div>

<div id="topbar">
 <div id="menuBtn">â˜°</div>
 <div style="margin-left:10px">7/D Sohbet</div>
</div>

<div id="sidebar">
 <div class="channel" onclick="switchRoom('main')">Main Kanal</div>
 <div class="channel" onclick="switchRoom('bilgi')">Bilgilendirme</div>
</div>

<div id="chat"></div>

<div id="inputBar">
 <input id="text" placeholder="Mesaj yaz...">
 <button onclick="send()">GÃ¶nder</button>
 <button onclick="fileInput.click()">ðŸ“·</button>
 <button onclick="sendVoice()">ðŸŽ¤</button>
 <input type="file" id="fileInput" accept="image/*,image/gif">
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, push, onChildAdded }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig = {
 apiKey: "AIzaSyBVMvgD3u-UT5dAk72pXqLub05qNPjqPW8",
 authDomain: "dsohbet.firebaseapp.com",
 databaseURL: "https://dsohbet-default-rtdb.europe-west1.firebasedatabase.app",
 projectId: "dsohbet",
 storageBucket: "dsohbet.firebasestorage.app",
 messagingSenderId: "992790719391",
 appId: "1:992790719391:web:e043ee4bdd47483910abaa"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

window.db = db;
window.ref = ref;
window.push = push;
window.onChildAdded = onChildAdded;
</script>

<script>
let username="", role="user", avatarURL="", room="main";

/* Avatar */
avatarInput.onchange = e=>{
 const reader=new FileReader();
 reader.onload=ev=>{
  avatar.src=ev.target.result;
  avatarURL=ev.target.result;
 };
 reader.readAsDataURL(e.target.files[0]);
};

function enter(){
 username=nameInput.value.trim();
 const code=codeInput.value.trim();
 if(!username) return alert("Ä°sim gir");

 if(code==="deop") role="admin";

 login.style.display="none";

 listenMessages();
}

/* MenÃ¼ */
menuBtn.onclick=()=>sidebar.classList.toggle("open");
chat.onclick=()=>sidebar.classList.remove("open");

function switchRoom(r){
 room=r;
 chat.innerHTML="";
 sidebar.classList.remove("open");
}

/* Firebase dinleme */
function listenMessages(){
 onChildAdded(ref(db,"messages"), snap=>{
  const m=snap.val();
  if(m.room===room) render(m);
 });
}

/* Mesaj gÃ¶nder */
function send(){
 const value=text.value.trim();
 if(!value) return;

 if(room==="bilgi" && role!=="admin"){
  alert("Sadece admin yazabilir");
  return;
 }

 push(ref(db,"messages"),{
  name:username,
  text:value,
  avatar:avatarURL,
  room:room
 });

 text.value="";
}

/* Render */
function render(m){
 const div=document.createElement("div");
 const side=m.name===username?"right":"left";
 div.className="msg "+side;

 const avatarImg=m.avatar
  ? `<img src="${m.avatar}" style="width:24px;height:24px;border-radius:50%;vertical-align:middle;margin-right:6px">`
  : "";

 div.innerHTML=avatarImg+"<b>"+m.name+"</b><br>"+m.text;

 chat.appendChild(div);
 chat.scrollTop=chat.scrollHeight;
}

/* Foto */
fileInput.onchange=e=>{
 const reader=new FileReader();
 reader.onload=ev=>{
  push(ref(db,"messages"),{
   name:username,
   avatar:avatarURL,
   room:room,
   text:`<img src="${ev.target.result}" style="max-width:200px;border-radius:10px">`
  });
 };
 reader.readAsDataURL(e.target.files[0]);
};

/* Voice */
async function sendVoice(){
 const stream=await navigator.mediaDevices.getUserMedia({audio:true});
 const rec=new MediaRecorder(stream);
 let chunks=[];
 rec.ondataavailable=e=>chunks.push(e.data);
 rec.onstop=()=>{
  const url=URL.createObjectURL(new Blob(chunks));
  push(ref(db,"messages"),{
   name:username,
   avatar:avatarURL,
   room:room,
   text:`<audio controls src="${url}"></audio>`
  });
 };
 rec.start();
 setTimeout(()=>rec.stop(),15000);
}
</script>

</body>
</html>
