<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>7/D Sohbet</title>

<style>
body{
 margin:0;
 font-family:Arial;
 background:black;
 color:white;
 overflow:hidden;
}

/* RGB arkaplan */
body::before{
 content:"";
 position:fixed;
 inset:0;
 background:linear-gradient(45deg, red, blue, lime, red);
 background-size:400% 400%;
 animation:rgb 12s linear infinite;
 opacity:.25;
 z-index:-1;
}
@keyframes rgb{
 0%{background-position:0% 50%}
 50%{background-position:100% 50%}
 100%{background-position:0% 50%}
}

#login{
 position:fixed;
 inset:0;
 background:#020617;
 display:flex;
 flex-direction:column;
 justify-content:center;
 align-items:center;
 gap:10px;
 z-index:10;
}

input{
 height:42px;
 width:230px;
 border-radius:10px;
 border:none;
 padding:0 10px;
 font-size:15px;
}

button{
 height:40px;
 padding:0 14px;
 border-radius:10px;
 border:none;
 background:#1e293b;
 color:white;
 cursor:pointer;
}

#topbar{
 height:55px;
 background:#020617;
 display:flex;
 align-items:center;
 justify-content:center;
 position:relative;
}

#onlineBtn{
 position:absolute;
 right:10px;
}

#onlinePanel{
 position:fixed;
 top:60px;
 left:50%;
 transform:translateX(-50%);
 background:#020617;
 padding:10px;
 border-radius:12px;
 display:none;
 min-width:200px;
 max-height:250px;
 overflow:auto;
}

.userItem{
 padding:6px;
 border-bottom:1px solid #1e293b;
 font-size:14px;
}

#chat{
 position:absolute;
 top:55px;
 bottom:70px;
 left:0;
 right:0;
 overflow-y:auto;
 padding:10px;
 display:flex;
 flex-direction:column;
 gap:8px;
}

.msg{
 max-width:70%;
 padding:10px 14px;
 border-radius:16px;
 font-size:14px;
 line-height:1.4;
 word-wrap:break-word;
 animation:fade .12s ease-out;
}

.user{ background:#1e293b; align-self:flex-start; border-bottom-left-radius:4px;}
.me{ background:#2563eb; align-self:flex-end; border-bottom-right-radius:4px;}
.admin{ background:#dc2626; align-self:flex-start; }

.msg img{
 max-width:180px;
 border-radius:10px;
 margin-top:5px;
}

@keyframes fade{
 from{opacity:.4;transform:translateY(3px)}
 to{opacity:1}
}

#inputBar{
 position:fixed;
 bottom:0;
 left:0;
 right:0;
 height:70px;
 background:#020617;
 display:flex;
 align-items:center;
 gap:6px;
 padding:8px;
}

#text{
 flex:1;
 height:40px;
 border:none;
 border-radius:10px;
 padding:0 10px;
 font-size:16px;
}
</style>
</head>

<body>

<audio id="notify" src="TT.m4a"></audio>

<div id="login">
 <input id="nameInput" placeholder="KullanÄ±cÄ± adÄ±">
 <input id="codeInput" placeholder="Kod">
 <input type="file" id="pfpInput" accept="image/*">
 <button onclick="enter()">GiriÅŸ</button>
</div>

<div id="topbar">
 <div>7/D Sohbet</div>
 <button id="onlineBtn" onclick="toggleOnline()">ðŸ‘¥ Aktif</button>
</div>

<div id="onlinePanel"></div>

<div id="chat"></div>

<div id="inputBar">
 <input id="text" placeholder="Mesaj...">
 <input type="file" id="imgInput" accept="image/*,image/gif">
 <button onclick="send()">GÃ¶nder</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { 
 getDatabase, ref, push, onChildAdded, set,
 onValue, onDisconnect
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig = {
 apiKey: "AIzaSyBVMvgD3u-UT5dAk72pXqLub05qNPjqPW8",
 authDomain: "dsohbet.firebaseapp.com",
 databaseURL: "https://dsohbet-default-rtdb.europe-west1.firebasedatabase.app",
 projectId: "dsohbet"
};

const app = initializeApp(firebaseConfig);
window.db = getDatabase(app);
window.ref = ref;
window.push = push;
window.onChildAdded = onChildAdded;
window.set = set;
window.onValue = onValue;
window.onDisconnect = onDisconnect;
</script>

<script>
let username="", role="user", pfp="";
let onlineRef;

/* GiriÅŸ */
function enter(){
 username=nameInput.value.trim();
 const code=codeInput.value.trim();
 if(!username) return alert("Ä°sim gir");

 if(code==="deop") role="admin";

 const file = pfpInput.files[0];
 if(file){
  const reader=new FileReader();
  reader.onload=e=>pfp=e.target.result;
  reader.readAsDataURL(file);
 }

 login.style.display="none";

 setupPresence();
 listenMessages();
 listenOnline();
}

/* Online presence */
function setupPresence(){
 onlineRef = ref(db,"online/"+username);

 set(onlineRef,{
  name:username,
  role:role,
  time:Date.now()
 });

 onDisconnect(onlineRef).remove();
}

/* Online listesi */
function listenOnline(){
 onValue(ref(db,"online"), snap=>{
  onlinePanel.innerHTML="";
  snap.forEach(child=>{
   const u=child.val();
   const div=document.createElement("div");
   div.className="userItem";
   div.textContent = u.name + (u.role==="admin" ? " (admin)" : "");
   onlinePanel.appendChild(div);
  });
 });
}

/* Mesajlar */
function listenMessages(){
 onChildAdded(ref(db,"messages"), snap=>{
  render(snap.val());
  notify.play();
 });
}

/* GÃ¶nder */
function send(){
 const value=text.value.trim();
 const file=imgInput.files[0];

 if(!value && !file) return;

 if(file){
  const reader=new FileReader();
  reader.onload=e=>{
   push(ref(db,"messages"),{
    name:username,
    role:role,
    text:value,
    img:e.target.result
   });
  };
  reader.readAsDataURL(file);
 } else {
  push(ref(db,"messages"),{
   name:username,
   role:role,
   text:value
  });
 }

 text.value="";
 imgInput.value="";
}

/* Render */
function render(m){
 const div=document.createElement("div");

 let cls="msg user";
 if(m.name===username) cls="msg me";
 if(m.role==="admin") cls="msg admin";

 div.className=cls;

 div.innerHTML="<b>"+m.name+"</b><br>"+(m.text||"");

 if(m.img){
  const img=document.createElement("img");
  img.src=m.img;
  div.appendChild(img);
 }

 chat.appendChild(div);
 chat.scrollTop=chat.scrollHeight;
}

/* Online panel toggle */
function toggleOnline(){
 onlinePanel.style.display =
  onlinePanel.style.display==="block" ? "none" : "block";
}
</script>

</body>
</html>
