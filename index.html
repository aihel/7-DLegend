<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>7/D Sohbet</title>

<style>
body{
 margin:0;
 font-family:Arial, sans-serif;
 color:white;
 overflow:hidden;
 background:black;
}

/* RGB */
body::before{
 content:"";
 position:fixed;
 inset:0;
 background:linear-gradient(45deg, red, blue, lime, red);
 background-size:400% 400%;
 animation:rgb 12s linear infinite;
 opacity:.25;
 z-index:-1;
}
@keyframes rgb{
 0%{background-position:0% 50%}
 50%{background-position:100% 50%}
 100%{background-position:0% 50%}
}

/* TOP */
#topbar{
 height:55px;
 background:#020617;
 display:flex;
 align-items:center;
 padding:0 15px;
}

#menuBtn{ font-size:26px; cursor:pointer; }

/* CHAT */
#chat{
 position:absolute;
 top:55px;
 bottom:70px;
 left:0;
 right:0;
 overflow-y:auto;
 padding:10px;
 display:flex;
 flex-direction:column;
 gap:8px;
}

.msg{
 max-width:70%;
 padding:10px 14px;
 border-radius:16px;
 font-size:14px;
 line-height:1.4;
 word-wrap:break-word;
 animation:fade .12s ease-out;
}

.left{ background:#1e293b; align-self:flex-start; border-bottom-left-radius:4px;}
.right{ background:#2563eb; align-self:flex-end; border-bottom-right-radius:4px;}

@keyframes fade{
 from{opacity:.4;transform:translateY(3px)}
 to{opacity:1}
}

/* INPUT */
#inputBar{
 position:fixed;
 bottom:0;
 left:0;
 right:0;
 height:70px;
 background:#020617;
 display:flex;
 align-items:center;
 gap:6px;
 padding:8px;
}

#text{
 flex:1;
 height:40px;
 border:none;
 border-radius:10px;
 padding:0 10px;
 font-size:16px;
}

button{
 height:40px;
 padding:0 14px;
 border-radius:10px;
 border:none;
 background:#1e293b;
 color:white;
 cursor:pointer;
}

/* LOGIN */
#login{
 position:fixed;
 inset:0;
 background:#020617;
 display:flex;
 justify-content:center;
 align-items:center;
 flex-direction:column;
 gap:10px;
 z-index:10;
}

#typing{
 font-size:12px;
 opacity:.6;
 height:14px;
}
#adminPanel{
 position:fixed;
 top:60px;
 right:10px;
 background:#020617;
 padding:10px;
 border-radius:12px;
 display:none;
}
</style>
</head>

<body>

<!-- MÜZİK -->
<audio id="bgm" src="TT.m4a" autoplay></audio>

<div id="login">
 <input id="nameInput" placeholder="Kullanıcı adı">
 <input id="codeInput" placeholder="Kod">
 <button onclick="enter()">Giriş</button>
</div>

<div id="topbar">
 <div style="font-size:18px">7/D Sohbet</div>
</div>

<div id="chat"></div>
<div id="typing"></div>

<div id="adminPanel">
 <button onclick="alert('Ban sistemi hazır')">Ban</button>
 <button onclick="alert('Mute sistemi hazır')">Mute</button>
</div>

<div id="inputBar">
 <input id="text" placeholder="Mesaj yaz..." oninput="typing()">
 <button onclick="send()">Gönder</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, push, onChildAdded }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig = {
 apiKey: "AIzaSyBVMvgD3u-UT5dAk72pXqLub05qNPjqPW8",
 authDomain: "dsohbet.firebaseapp.com",
 databaseURL: "https://dsohbet-default-rtdb.europe-west1.firebasedatabase.app",
 projectId: "dsohbet"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

window.db=db;
window.ref=ref;
window.push=push;
window.onChildAdded=onChildAdded;
</script>

<script>
let username="", role="user";

/* Müzik loop */
bgm.onended=()=>bgm.play();

/* Giriş */
function enter(){
 username=nameInput.value.trim();
 const code=codeInput.value.trim();
 if(!username) return alert("İsim gir");

 if(code==="deop"){
  role="admin";
  adminPanel.style.display="block";
 }

 login.style.display="none";

 listen();
}

/* Firebase */
function listen(){
 onChildAdded(ref(db,"messages"), snap=>{
  render(snap.val());
 });
}

/* Gönder */
function send(){
 const value=text.value.trim();
 if(!value) return;

 push(ref(db,"messages"),{
  name:username,
  text:value
 });

 text.value="";
 typingBox("");
}

/* Baloncuk */
function render(m){
 const div=document.createElement("div");
 const side=m.name===username?"right":"left";
 div.className="msg "+side;
 div.innerHTML="<b>"+m.name+"</b><br>"+m.text;
 chat.appendChild(div);
 chat.scrollTop=chat.scrollHeight;
}

/* Yazıyor efekti */
let typingTimer;
function typing(){
 typingBox(username+" yazıyor...");
 clearTimeout(typingTimer);
 typingTimer=setTimeout(()=>typingBox(""),1000);
}
function typingBox(t){ typing.innerText=t; }
</script>

</body>
</html>
